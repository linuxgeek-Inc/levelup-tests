##### DNS 문제 어떻게 진단하나요 ? #####

**1) DNS 진단 도구 설치**

```bash
sudo dnf install -y bind-utils
```

```tech
sudo,dnf,install,bind-utils,bash,rocky
```

```desc
#### 📦 DNS 진단 도구 설치
`sudo dnf install -y bind-utils`는 `dig`, `nslookup` 등 DNS 관련 문제를 진단하는 데 필수적인 도구들이 포함된 `bind-utils` 패키지를 설치합니다.

- **sudo**: 관리자 권한으로 실행합니다.
- **dnf install -y**: Rocky Linux에서 패키지를 설치하며, 모든 확인 프롬프트에 자동으로 'yes'로 답합니다.

> 💡 `dig`나 `nslookup` 명령어가 없다면 가장 먼저 이 패키지를 설치해야 합니다.
```

**2) www.google.com IP 주소 변수에 저장**

```bash
GOOGLE_IP=$(dig +short www.google.com | grep -E '^[0-9]+\.' | head -n 1)
```

```tech
dig,grep,head,bash,rocky
```

```desc
#### 📝 IP 주소 변수에 저장
`dig` 명령어로 `www.google.com`의 IP 주소를 조회하여 `GOOGLE_IP`라는 셸 변수에 저장합니다. 이 변수는 나중에 DNS가 동작하지 않는 상황에서 직접 IP로 접속을 테스트할 때 사용됩니다.

- **dig +short**: 도메인에 대한 IP 주소만 간결하게 출력합니다.
- **grep, head**: 여러 IP 중 첫 번째 유효한 IP 주소만 필터링합니다.

> 💡 정상 상태의 IP 주소를 미리 변수에 저장해두면, 문제 발생 시 원인 분석에 유용하게 사용할 수 있습니다.
```

**3) www.google.com IP 주소 확인**

```bash
dig +short www.google.com
```

```tech
dig,bash,rocky
```

```desc
#### 🌐 도메인 IP 주소 확인
`dig +short www.google.com` 명령어를 실행하여 현재 시스템의 DNS 설정이 정상적으로 동작하여 `www.google.com`의 IP 주소를 잘 가져오는지 확인합니다.

- **정상 확인**: 이 단계에서 IP 주소가 출력되면, 현재 DNS 설정은 정상입니다.

> 💡 DNS 문제 해결의 첫 단계는 `dig`나 `nslookup`으로 도메인 조회가 되는지 확인하는 것입니다.
```

**4) 정상적인 HTTP 연결 확인**

```bash
curl -I www.google.com
```

```tech
curl,bash,rocky
```

```desc
#### ✅ HTTP 연결 테스트
`curl -I www.google.com` 명령어로 `www.google.com` 서버와 정상적으로 통신이 되는지 확인합니다. 이 명령이 성공하려면 DNS 조회가 선행되어야 합니다.

- **HTTP/2 200**: 성공적으로 연결되면 상태 코드 200을 포함한 헤더 정보가 출력됩니다.

> 💡 DNS가 정상이더라도 방화벽 등의 다른 문제로 통신이 안 될 수 있으므로, 실제 서비스(HTTP 등)로 연결을 확인하는 것이 좋습니다.
```

**5) DNS 설정 파일 강제 초기화**

* 참고: 의도적으로 `DNS 문제 상황 재현`

```bash
sudo bash -c "echo > /etc/resolv.conf"
```

```tech
sudo,bash,echo,bash,rocky
```

```desc
#### 💣 DNS 설정 파일 강제 초기화
`sudo bash -c "echo > /etc/resolv.conf"`는 시스템의 DNS 서버 설정 파일인 `/etc/resolv.conf`의 내용을 강제로 비워버립니다. 이로써 시스템은 DNS 서버를 찾지 못해 도메인 이름 해석을 할 수 없게 됩니다.

- **sudo bash -c "..."**: 관리자 권한으로 파일에 쓰는 작업을 하기 위해 사용합니다.
- **> /etc/resolv.conf**: 파일의 내용을 덮어씁니다.

> 💡 DNS 장애 상황을 인위적으로 만들어 문제 해결 과정을 연습하기 위한 단계입니다.
```

**6) 도메인 이름으로 연결 실패❌ 확인**

```bash
curl -I www.google.com
```

```tech
curl,bash,rocky
```

```desc
#### ❌ 연결 실패 확인
`/etc/resolv.conf` 파일이 비워진 상태에서 다시 `curl` 명령어를 실행하면, `Could not resolve host`와 같은 오류가 발생하며 연결에 실패합니다.

- **원인**: 시스템이 `www.google.com`이라는 도메인 이름을 IP 주소로 변환할 방법을 모르기 때문입니다.

> 💡 "Could not resolve host" 오류는 DNS 문제일 가능성이 매우 높다는 강력한 신호입니다.
```

**7) 저장된 IP 주소 확인**

```bash
echo $GOOGLE_IP
```

```tech
echo,bash,rocky
```

```desc
#### 📝 변수 값 확인
`echo $GOOGLE_IP` 명령어로 이전에 저장해 둔 Google IP 주소가 셸 변수에 여전히 남아있는지 확인합니다.

- **셸 변수**: 시스템 DNS 설정과 무관하게 셸 세션 동안 값을 유지합니다.

> 💡 시스템 설정이 변경되어도 셸 변수는 영향을 받지 않는다는 점을 보여줍니다.
```

**8) IP 주소로 직접 연결 성공 확인**

```bash
ping -c 5 $GOOGLE_IP
```

```tech
ping,bash,rocky
```

```desc
#### 핑 테스트 (IP 직접 사용)
`ping -c 5 $GOOGLE_IP`는 도메인 이름 대신 저장해둔 IP 주소로 직접 통신을 시도합니다. DNS 조회가 필요 없으므로 정상적으로 `ping`이 성공하는 것을 볼 수 있습니다.

- **-c 5**: 5번만 ping을 보냅니다.

> 💡 도메인 이름으로는 실패하지만 IP 주소로는 성공한다면, 문제는 거의 확실히 DNS에 있습니다. 네트워크 자체의 문제는 아님을 증명합니다.
```

**9) 특정 DNS 서버(8.8.8.8)로 직접 질의**

```bash
nslookup google.com 8.8.8.8
```

```tech
nslookup,bash,rocky
```

```desc
#### 🎯 특정 DNS 서버로 직접 조회
`nslookup google.com 8.8.8.8`은 시스템의 `/etc/resolv.conf` 설정을 무시하고, 지정된 DNS 서버(Google Public DNS `8.8.8.8`)에게 직접 `google.com`의 IP 주소를 물어봅니다.

- **정상 응답**: 시스템 DNS 설정이 망가졌더라도, 외부 DNS 서버가 정상이라면 IP 주소를 잘 알려줍니다.

> 💡 시스템 설정 문제인지, 아니면 네트워크 전체의 DNS 문제인지 범위를 좁힐 때 유용한 방법입니다.
```

**10) DNS 설정 복구**

```bash
sudo bash -c "echo nameserver 8.8.8.8 > /etc/resolv.conf"
```

```tech
sudo,bash,echo,bash,rocky
```

```desc
#### 🔧 DNS 설정 복구
`sudo bash -c "echo nameserver 8.8.8.8 > /etc/resolv.conf"` 명령어로 `/etc/resolv.conf` 파일에 Google DNS 서버(`8.8.8.8`)를 다시 설정하여 망가진 DNS 설정을 복구합니다.

- **nameserver 8.8.8.8**: 이 시스템이 사용할 DNS 서버를 지정합니다.

> 💡 임시로 또는 영구적으로 DNS 서버를 수동 설정할 때 사용하는 방법입니다.
```

**11) 복구 후 HTTP 연결 확인**

```bash
curl -I www.google.com
```

```tech
curl,bash,rocky
```

```desc
#### 🎉 최종 연결 확인
DNS 설정이 복구된 후, 다시 `curl -I www.google.com`을 실행하면 정상적으로 연결이 성공하는 것을 확인할 수 있습니다.

- **문제 해결**: DNS 설정이 올바르게 복원되어 도메인 이름 해석이 가능해졌습니다.

> 💡 문제를 해결한 후에는 반드시 원래 하려던 작업이 정상적으로 동작하는지 재확인하는 것이 중요합니다.
```

**12) 실습 종료**

```bash
: quit
```

```tech
bash,rocky
```

```desc
#### 👋 실습 종료
실습을 종료를 의미하는 `quit` 명령어를 실행합니다.
현재 터미널 세션을 종료합니다.

> 💡 모든 실습을 마친 후 사용합니다.
```