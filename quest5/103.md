##### Swarm: 3κ° λ³µμ λ³Έ Nginx μ„λΉ„μ¤ μƒμ„± λ°©λ²• #####

> **μ°Έκ³ :** μ΄ μ‹¤μµμ—μ„λ” κ΄€λ¦¬μ λ…Έλ“ IPλ΅ `192.168.0.2`μ„ μ‚¬μ©ν•©λ‹λ‹¤. μ‹¤μ  ν™κ²½μ— λ§κ² IP μ£Όμ†λ¥Ό λ³€κ²½ν•μ—¬ μ‹¤ν–‰ν•μ„Έμ”.

**1) Manager Node: 3κ° λ³µμ λ³Έμ„ κ°€μ§„ Nginx μ„λΉ„μ¤ μƒμ„±**
κ΄€λ¦¬μ λ…Έλ“μ—μ„ `replicas` μµμ…μ„ `3`μΌλ΅ μ„¤μ •ν•μ—¬, 3κ°μ μ»¨ν…μ΄λ„(μ‘μ—…)κ°€ μ‹¤ν–‰λλ” `nginx-x3` μ„λΉ„μ¤λ¥Ό μƒμ„±ν•©λ‹λ‹¤. ν¬νΈλ” 8081λ΅ λ§¤ν•‘ν•©λ‹λ‹¤.

```bash
docker service create --name nginx-x3 --replicas 3 --publish published=8081,target=80 nginx:latest
```

```tech
docker, swarm, nginx
```

```desc
#### π€ 3κ° λ³µμ λ³Έμ„ κ°€μ§„ μ„λΉ„μ¤ μƒμ„±
Nginx μ„λΉ„μ¤λ¥Ό μƒμ„±ν•λ, 3κ°μ λ™μΌν• μ»¨ν…μ΄λ„κ°€ λ™μ‹μ— μ‹¤ν–‰λλ„λ΅ μ„¤μ •ν•©λ‹λ‹¤.

- **`docker service create`**: μƒλ΅μ΄ μ„λΉ„μ¤λ¥Ό μƒμ„±
- **`--replicas 3`**: μ„λΉ„μ¤μ μ»¨ν…μ΄λ„(λ³µμ λ³Έ) μλ¥Ό 3κ°λ΅ μ§€μ •
- **`--publish ...`**: νΈμ¤νΈμ 8081 ν¬νΈλ¥Ό μ»¨ν…μ΄λ„μ 80 ν¬νΈλ΅ μ—°κ²°
- **`--name nginx-x3`**: μ„λΉ„μ¤ μ΄λ¦„μ„ `nginx-x3`λ΅ μ„¤μ •

> π’΅ `--replicas` μµμ…μΌλ΅ μ„λΉ„μ¤μ κ·λ¨λ¥Ό μ‰½κ² ν™•μ¥(Scale out)ν•  μ μμµλ‹λ‹¤.
```

**2) Manager Node: μ„λΉ„μ¤ λ³µμ λ³Έ μƒνƒ ν™•μΈ**
`docker service ls` λ…λ Ήμ–΄λ΅ `nginx-x3` μ„λΉ„μ¤μ `REPLICAS`κ°€ `3/3`μΌλ΅ ν‘μ‹λλ”μ§€ ν™•μΈν•©λ‹λ‹¤.

```bash
docker service ls
```

```tech
docker, swarm
```

```desc
#### π“‹ μ„λΉ„μ¤ λ³µμ λ³Έ μƒνƒ ν™•μΈ
`docker service ls`λ¥Ό μ‹¤ν–‰ν•μ—¬ `nginx-x3` μ„λΉ„μ¤μ λ³µμ λ³Έ μƒνƒλ¥Ό ν™•μΈν•©λ‹λ‹¤.

- **`REPLICAS`**: `3/3`μΌλ΅ ν‘μ‹λλ©΄ μ”μ²­ν• 3κ°μ μ»¨ν…μ΄λ„κ°€ λ¨λ‘ μ •μƒμ μΌλ΅ μ‹¤ν–‰ μ¤‘μ„μ„ μλ―Έν•©λ‹λ‹¤.

> π’΅ λ§μ•½ `1/3`μ΄λ‚ `2/3`μ΄λΌλ©΄, μ•„μ§ Swarmμ΄ μ»¨ν…μ΄λ„λ¥Ό μƒμ„± μ¤‘μΈ μƒνƒμΌ μ μμµλ‹λ‹¤.
```

**3) Manager Node: 3κ° μ‘μ—…(Task) μƒμ„Έ μƒνƒ ν™•μΈ**
`docker service ps` λ…λ Ήμ–΄λ¥Ό μ‚¬μ©ν•μ—¬ 3κ°μ μ‘μ—…μ΄ κ°κ° μ–΄λ λ…Έλ“μ— λ¶„μ‚°λμ–΄ μ‹¤ν–‰λκ³  μλ”μ§€ ν™•μΈν•©λ‹λ‹¤.

```bash
docker service ps nginx-x3
```

```tech
docker, swarm
```

```desc
#### π” μ‘μ—… λ¶„μ‚° μƒνƒ ν™•μΈ
`nginx-x3` μ„λΉ„μ¤λ¥Ό κµ¬μ„±ν•λ” 3κ°μ μ‘μ—…(μ»¨ν…μ΄λ„)μ΄ κ°κ° μ–΄λ λ…Έλ“μ— λ°°ν¬λμ—λ”μ§€ ν™•μΈν•©λ‹λ‹¤.

- **`docker service ps nginx-x3`**: `nginx-x3` μ„λΉ„μ¤μ λ¨λ“  μ‘μ—…μ„ λ‚μ—΄
- **`NODE`** μ»¬λΌ: μ‘μ—…μ΄ μ‹¤ν–‰ μ¤‘μΈ λ…Έλ“μ μ΄λ¦„μ„ λ³΄μ—¬μ¤

> π’΅ Swarm μ¤μΌ€μ¤„λ¬λ” κ°€οΏ½οΏ½ν• λ…Έλ“λ“¤μ—κ² μ‘μ—…μ„ μ μ ν λ¶„μ‚°ν•μ—¬ λ°°ν¬ν•©λ‹λ‹¤.
```

**4) Manager Node: 10μ΄κ°„ μ ‘μ†ν•μ—¬ λ΅λ“ λ°Έλ°μ‹± ν™•μΈ**
`watch`λ¥Ό μ‚¬μ©ν•μ—¬ 10μ΄ λ™μ• 1μ΄λ§λ‹¤ `nginx-x3` μ„λΉ„μ¤μ— λ°λ³µμ μΌλ΅ μ ‘μ†ν•©λ‹λ‹¤. Swarmμ΄ μ”μ²­μ„ 3κ°μ μ»¨ν…μ΄λ„λ΅ λ¶„μ‚°μ‹ν‚¤λ―€λ΅, λ§¤λ² λ‹¤λ¥Έ μ»¨ν…μ΄λ„ νΈμ¤νΈλ„¤μ„μ΄ μ¶λ ¥λλ” κ²ƒμ„ ν™•μΈν•  μ μμµλ‹λ‹¤.

```bash
timeout 10s watch -n 1 curl http://192.168.0.2:8081
```

```tech
docker, swarm, nginx
```

```desc
#### β–οΈ λ΅λ“ λ°Έλ°μ‹± ν…μ¤νΈ
μ„λΉ„μ¤μ— λ°λ³µμ μΌλ΅ μ”μ²­μ„ λ³΄λ‚΄ Swarmμ λ‚΄μ¥ λ΅λ“ λ°Έλ°μ„κ°€ νΈλν”½μ„ μ—¬λ¬ μ»¨ν…μ΄λ„λ΅ λ¶„μ‚°μ‹ν‚¤λ”μ§€ ν™•μΈν•©λ‹λ‹¤.

- **`timeout 10s watch -n 1`**: 10μ΄ λ™μ• 1μ΄ κ°„κ²©μΌλ΅ λ…λ Ή λ°λ³µ
- **`curl ...`**: μ„λΉ„μ¤μ— HTTP μ”μ²­ μ „μ†΅

> π’΅ `curl` μ”μ²­μ— λ€ν• μ‘λ‹µμ΄ κ³„μ† λ°”λ€λ‹¤λ©΄, μ΄λ” μ”μ²­μ΄ μ„λ΅ λ‹¤λ¥Έ μ»¨ν…μ΄λ„λ΅ μ „λ‹¬λκ³  μμμ„ μλ―Έν•λ©°, λ΅λ“ λ°Έλ°μ‹±μ΄ μ λ™μ‘ν•κ³  μλ‹¤λ” μ¦κ±°μ…λ‹λ‹¤.
```