##### K8s: kubectl top으로 CPU/메모리 사용량 확인 #####

**1) 노드(Node)의 리소스 사용량 확인**

**- 참고:** `metrics-server` 로딩 대기시간을 위해 30초 sleep 실행

```bash
sleep 30 && kubectl top node
```
```tech
bash,kubectl,kubernetes
```
```desc
#### 🖥️ 노드 리소스 사용량 확인하기
클러스터 내 모든 노드(서버)의 현재 CPU 및 메모리 사용량을 확인합니다.

**- 참고:** `metrics-server` 로딩 대기시간을 위해 30초 sleep 실행

- **`kubectl top node`**: 각 노드의 리소스 사용량을 보여주는 명령어
- **`watch`**: 명령어를 주기적으로 반복 실행하여 결과를 동적으로 보여줌
- **`timeout 30`**: 30초 후에 `watch` 명령어를 자동으로 종료

> 💡 클러스터 전체의 부하 상태를 한눈에 파악할 때 유용합니다.
```

**2) 테스트용 파드 생성**
```bash
kubectl create deployment top-test --image=nginx --replicas=2
```
```tech
bash,kubectl,kubernetes
```
```desc
#### 🚀 테스트용 파드 생성하기
리소스 사용량을 확인할 테스트용 Nginx 파드를 2개 생성합니다.

- **`kubectl create deployment`**: 새로운 디플로이먼트를 생성
- **`top-test`**: 디플로이먼트의 이름
- **`--image=nginx`**: 사용할 컨테이너 이미지
- **`--replicas=2`**: 생성할 파드의 개수

> 💡 `Deployment`는 파드를 관리하고 안정적으로 유지하는 역할을 합니다.
```

**3) Deployment가 준비 될 때까지 wait**
```bash
kubectl wait --for=condition=available deployment/top-test --timeout=60s
```
```tech
kubectl
```
```desc
#### ⏳ 파드 준비 상태 대기하기
생성한 디플로이먼트의 파드들이 'Available'(사용 가능) 상태가 될 때까지 기다립니다.

- **`kubectl wait`**: 특정 조건이 충족될 때까지 대기
- **`--for=condition=available`**: 'Available' 상태를 기다림
- **`deployment/top-test`**: 대상 디플로이먼트
- **`--timeout=60s`**: 최대 60초까지 기다리고, 초과 시 오류 발생

> 💡 스크립트에서 파드가 완전히 실행된 후 다음 명령을 실행해야 할 때 유용합니다.
```

**4) 파드(Pod)의 리소스 사용량 확인**

**- 참고:** `metrics-server` 로딩 대기시간을 위해 30초 sleep 실행

```bash
sleep 30 && kubectl top pod
```
```tech
bash,kubectl,kubernetes
```
```desc
#### 📊 파드 리소스 사용량 확인하기
현재 네임스페이스에 있는 모든 파드의 CPU 및 메모리 사용량을 확인합니다.

- **`kubectl top pod`**: 파드의 리소스 사용량을 보여주는 명령어
- **`watch`**: 결과를 주기적으로 갱신하여 동적으로 보여줌
- **`timeout 10`**: 10초 후 `watch` 명령어 자동 종료

> 💡 어떤 파드가 리소스를 많이 사용하는지 실시간으로 모니터링할 수 있습니다.
```

**5) 특정 네임스페이스의 파드 리소스 사용량 확인**
```bash
kubectl top pod -n kube-system
```
```tech
bash,kubectl,kubernetes
```
```desc
#### 🎯 특정 네임스페이스 파드 확인하기
`-n` 옵션을 사용하여 지정된 네임스페이스의 파드 리소스 사용량만 확인합니다.

- **`kubectl top pod`**: 파드 리소스 사용량 확인
- **`-n kube-system`**: `kube-system` 네임스페이스를 지정

> 💡 쿠버네티스 시스템 자체의 구성요소들이 사용하는 리소스를 확인할 때 유용합니다.
```

**6) 모든 네임스페이스의 파드 리소스 사용량 확인**
```bash
kubectl top pod --all-namespaces
```
```tech
bash,kubectl,kubernetes
```
```desc
#### 🌐 모든 네임스페이스 파드 확인하기
`--all-namespaces` 옵션을 사용하여 클러스터 내 모든 네임스페이스의 파드 리소스 사용량을 확인합니다.

- **`kubectl top pod`**: 파드 리소스 사용량 확인
- **`--all-namespaces`**: 모든 네임스페이스를 대상으로 지정

> 💡 클러스터 전체에서 어떤 파드가 리소스를 많이 사용하는지 한 번에 파악할 수 있습니다.
```

**7) 실습 자원 정리**
```bash
kubectl delete deployment top-test
```
```tech
bash,kubectl,kubernetes
```
```desc
#### 🧹 실습 자원 정리하기
실습을 위해 생성했던 디플로이먼트를 삭제합니다.

- **`kubectl delete deployment`**: 디플로이먼트를 삭제하는 명령어
- **`top-test`**: 삭제할 디플로이먼트의 이름

> 💡 디플로이먼트를 삭제하면 관련된 파드(Pod)와 레플리카셋(ReplicaSet)도 함께 정리됩니다.
```
