##### Swarm: Nginx μ›Ή μ„λ²„ μ„λΉ„μ¤ λ°°ν¬ λ°©λ²• #####

**μ°Έκ³ :** μ΄ μ‹¤μµμ—μ„λ” κ΄€λ¦¬μ λ…Έλ“ IPλ΅ `192.168.0.2`, μ‘μ—…μ λ…Έλ“ IPλ΅ `192.168.0.3`μ„ μ‚¬μ©ν•©λ‹λ‹¤. μ‹¤μ  ν™κ²½μ— λ§κ² IP μ£Όμ†λ¥Ό λ³€κ²½ν•μ—¬ μ‹¤ν–‰ν•μ„Έμ”.

**1) Manager Node: Nginx μ„λΉ„μ¤ μƒμ„± λ° λ°°ν¬**
κ΄€λ¦¬μ λ…Έλ“(192.168.0.2)μ—μ„ Nginx μ΄λ―Έμ§€λ¥Ό μ‚¬μ©ν•μ—¬ `my-nginx`λΌλ” μ΄λ¦„μ μ„λΉ„μ¤λ¥Ό μƒμ„±ν•κ³ , μ™Έλ¶€ ν¬νΈ 8080μ„ μ»¨ν…μ΄λ„μ 80 ν¬νΈλ΅ λ§¤ν•‘ν•©λ‹λ‹¤.

```bash
docker service create --name my-nginx --publish published=8080,target=80 nginx:latest
```

```tech
docker, swarm, nginx
```

```desc
#### π€ Nginx μ„λΉ„μ¤ μƒμ„± λ° λ°°ν¬
Swarm ν΄λ¬μ¤ν„°μ— Nginx μ›Ήμ„λ²„λ¥Ό μ„λΉ„μ¤ ν•νƒλ΅ λ°°ν¬ν•©λ‹λ‹¤.

- **`docker service create`**: μƒλ΅μ΄ μ„λΉ„μ¤λ¥Ό μƒμ„±ν•λ” λ…λ Ήμ–΄
- **`--name my-nginx`**: μ„λΉ„μ¤μ μ΄λ¦„μ„ `my-nginx`λ΅ μ§€μ •
- **`--publish ...`**: νΈμ¤νΈμ 8080 ν¬νΈλ¥Ό μ»¨ν…μ΄λ„μ 80 ν¬νΈμ™€ μ—°κ²°
- **`nginx:latest`**: μ‚¬μ©ν•  λ„μ»¤ μ΄λ―Έμ§€

> π’΅ μ„λΉ„μ¤λ΅ λ°°ν¬ν•λ©΄, Swarmμ΄ μ»¨ν…μ΄λ„μ μ‹¤ν–‰, ν™•μ¥, λ³µκµ¬ λ“±μ„ μλ™μΌλ΅ κ΄€λ¦¬ν•΄μ¤λ‹λ‹¤.
```

**2) Manager Node: μ„λΉ„μ¤ λ°°ν¬ μƒνƒ ν™•μΈ**
μ„λΉ„μ¤κ°€ μ •μƒμ μΌλ΅ μƒμ„±λκ³  μ‹¤ν–‰ μ¤‘μΈμ§€ ν™•μΈν•©λ‹λ‹¤. `REPLICAS`κ°€ `1/1`μ΄ λ  λ•κΉμ§€ μ μ‹ κΈ°λ‹¤λ ¤μ•Ό ν•  μ μμµλ‹λ‹¤.

```bash
docker service ls
```

```tech
docker, swarm
```

```desc
#### π“‹ μ„λΉ„μ¤ λ©λ΅ λ° μƒνƒ ν™•μΈ
ν„μ¬ Swarm ν΄λ¬μ¤ν„°μ—μ„ μ‹¤ν–‰ μ¤‘μΈ λ¨λ“  μ„λΉ„μ¤μ λ©λ΅μ„ λ³΄μ—¬μ¤λ‹λ‹¤.

- **`docker service ls`**: ν΄λ¬μ¤ν„°μ λ¨λ“  μ„λΉ„μ¤λ¥Ό λ‚μ—΄
- **`NAME`**: μ„λΉ„μ¤μ μ΄λ¦„
- **`REPLICAS`**: (μ‹¤ν–‰ μ¤‘μΈ λ³µμ λ³Έ μ) / (μ”μ²­λ λ³µμ λ³Έ μ)

> π’΅ `REPLICAS`κ°€ `1/1`μ΄ λλ©΄ μ„λΉ„μ¤κ°€ μ •μƒμ μΌλ΅ μ‹¤ν–‰λκ³  μλ‹¤λ” μλ―Έμ…λ‹λ‹¤.
```

**3) Manager Node: μ„λΉ„μ¤ μ‘μ—…(Task) μƒνƒ ν™•μΈ**
`my-nginx` μ„λΉ„μ¤μ— μ†ν• μ‘μ—…(μ»¨ν…μ΄λ„)μ μ‹¤ν–‰ μƒνƒμ™€ μ–΄λ λ…Έλ“μ—μ„ μ‹¤ν–‰λκ³  μλ”μ§€ μƒμ„Έν•κ² ν™•μΈν•©λ‹λ‹¤.

```bash
docker service ps my-nginx
```
```no-err-check
```
```tech
docker, swarm
```

```desc
#### π” μ„λΉ„μ¤μ μ‘μ—…(Task) μƒμ„Έ ν™•μΈ
νΉμ • μ„λΉ„μ¤(`my-nginx`)λ¥Ό κµ¬μ„±ν•λ” κ°λ³„ μ»¨ν…μ΄λ„(Task)λ“¤μ μƒνƒλ¥Ό μμ„Έν λ³΄μ—¬μ¤λ‹λ‹¤.

- **`docker service ps`**: μ„λΉ„μ¤μ— μ†ν• μ‘μ—…λ“¤μ λ©λ΅μ„ μ¶λ ¥
- **`NODE`**: ν•΄λ‹Ή μ‘μ—…μ΄ μ‹¤ν–‰λκ³  μλ” λ…Έλ“
- **`CURRENT STATE`**: μ‘μ—…μ ν„μ¬ μƒνƒ (μ: `Running`)

> π’΅ μ–΄λ–¤ λ…Έλ“μ—μ„ μ»¨ν…μ΄λ„κ°€ λκ³  μλ”μ§€ ν™•μΈν•  λ• μ μ©ν•©λ‹λ‹¤.
```

**4) μ™Έλ¶€μ—μ„ μ›Ή μ„λ²„ μ ‘μ† ν™•μΈ (Manager Node)**
κ΄€λ¦¬μ λ…Έλ“μ IPμ™€ μ§€μ •λ ν¬νΈ(8080)λ΅ μ ‘μ†ν•μ—¬ Nginx κΈ°λ³Έ νμ΄μ§€κ°€ ν‘μ‹λλ”μ§€ ν™•μΈν•©λ‹λ‹¤.

```bash
curl http://192.168.0.2:8080
```

```tech
docker, swarm, nginx
```

```desc
#### β… Manager λ…Έλ“λ΅ μ›Ή μ ‘μ† ν…μ¤νΈ
`curl`μ„ μ΄μ©ν•΄ κ΄€λ¦¬μ λ…Έλ“μ IPμ™€ μ„λΉ„μ¤ ν¬νΈλ΅ μ ‘μ†ν•μ—¬ Nginxκ°€ μ μ‹¤ν–‰λλ”μ§€ ν™•μΈν•©λ‹λ‹¤.

- **`curl`**: URLλ΅ λ°μ΄ν„°λ¥Ό μ”μ²­ν•λ” λ…λ Ήμ–΄
- **`192.168.0.2:8080`**: (κ΄€λ¦¬μ λ…Έλ“ IP):(μ„λΉ„μ¤ ν¬νΈ)

> π’΅ Nginxμ κΈ°λ³Έ ν™μ νμ΄μ§€κ°€ λ³΄μ΄λ©΄ μ„±κ³µμ…λ‹λ‹¤.
```

**5) μ™Έλ¶€μ—μ„ μ›Ή μ„λ²„ μ ‘μ† ν™•μΈ (Worker Node)**
Swarmμ λΌμ°ν… λ©”μ‹(Routing Mesh) κΈ°λ¥ λ•λ¶„μ—, μ‘μ—…μ λ…Έλ“μ IPλ΅λ„ λ™μΌν•κ² μ ‘μ†ν•  μ μμµλ‹λ‹¤.

```bash
curl http://192.168.0.3:8080
```

```tech
docker, swarm, nginx
```

```desc
#### β… Worker λ…Έλ“λ΅ μ›Ή μ ‘μ† ν…μ¤νΈ
Swarmμ λΌμ°ν… λ©”μ‹ κΈ°λ¥ λ•λ¶„μ—, ν΄λ¬μ¤ν„° λ‚΄ μ–΄λ–¤ λ…Έλ“μ IPλ΅ μ ‘μ†ν•΄λ„ μ„λΉ„μ¤μ— μ ‘κ·Όν•  μ μμµλ‹λ‹¤.

- **`curl`**: URLλ΅ λ°μ΄ν„°λ¥Ό μ”μ²­ν•λ” λ…λ Ήμ–΄
- **`192.168.0.3:8080`**: (μ‘μ—…μ λ…Έλ“ IP):(μ„λΉ„μ¤ ν¬νΈ)

> π’΅ μ»¨ν…μ΄λ„κ°€ μ‹¤ν–‰λμ§€ μ•λ” λ…Έλ“λ΅ μ”μ²­ν•΄λ„ Swarmμ΄ μ•μ•„μ„ μ”μ²­μ„ μ¬λ°”λ¥Έ μ»¨ν…μ΄λ„λ΅ μ „λ‹¬ν•΄μ¤λ‹λ‹¤. μ΄κ²ƒμ΄ λΌμ°ν… λ©”μ‹μ ν•µμ‹¬ κΈ°λ¥μ…λ‹λ‹¤.
```
