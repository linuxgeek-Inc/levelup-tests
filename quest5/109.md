##### Swarm: 서비스 컨테이너 실행 로그 확인 #####

> **참고:** 이 실습에서는 관리자 노드 IP로 `192.168.0.2`을 사용합니다. 실제 환경에 맞게 IP 주소를 변경하여 실행하세요.

**1) Manager Node: 로그 확인용 서비스 생성**
로그를 확인할 `nginx-log-test` 서비스를 3개의 복제본으로 생성합니다.

```bash
docker service create --name nginx-log-test --replicas 3 --publish 8091:80 nginx
```

```tech
docker, swarm, nginx
```

```desc
#### 🚀 로그 확인용 샘플 서비스 생성
서비스 로그를 확인하는 방법을 테스트하기 위해 3개의 복제본을 가진 Nginx 서비스를 생성합니다.

- **`--replicas 3`**: 여러 컨테이너에서 발생하는 로그를 한 번에 보는 상황을 만들기 위함
- **`--name nginx-log-test`**: 서비스의 용도를 명확히 하는 이름

> 💡 여러 컨테이너에 걸쳐 로그가 어떻게 수집되는지 확인하는 것이 이번 실습의 핵심입니다.
```

**2) Manager Node: 서비스에 여러 번 접속하여 로그 생성**
`for` 루프를 사용하여 서비스에 5번 접속 요청을 보냅니다. 이 요청들은 3개의 컨테이너에 분산되어 각각의 로그에 기록됩니다.

```bash
for i in {1..5}; do curl -s http://192.168.0.2:8091 > /dev/null; echo "Request $i sent"; sleep 0.5; done
```

```tech
docker, swarm, nginx
```

```desc
#### 🎯 의도적으로 로그 생성하기
`for` 반복문과 `curl`을 사용하여 Nginx 서비스에 여러 번 접속 요청을 보내 로그를 발생시킵니다.

- **`for i in {1..5}`**: 5번 반복
- **`curl -s ... > /dev/null`**: 접속 요청을 보내되, 결과는 화면에 출력하지 않음
- **`sleep 0.5`**: 0.5초 대기

> 💡 이렇게 생성된 접속 기록(access log)이 각 Nginx 컨테이너에 남게 됩니다.
```

**3) Manager Node: 서비스의 모든 로그 통합 확인**
`docker service logs` 명령어를 사용하면 `nginx-log-test` 서비스를 구성하는 모든 컨테이너(Task)의 로그를 취합하여 한 번에 보여줍니다. 어느 노드의 어느 컨테이너에서 발생한 로그인지도 함께 표시됩니다.

```bash
docker service logs nginx-log-test
```

```tech
docker, swarm
```

```desc
#### 📋 서비스의 모든 로그 통합 조회
`docker service logs`를 사용하여 특정 서비스에 속한 모든 컨테이너의 로그를 한 곳에서 모아봅니다.

- **`docker service logs`**: 서비스의 로그를 출력하는 명령어
- **`nginx-log-test`**: 로그를 조회할 서비스 이름

> 💡 로그 앞에 붙는 `nginx-log-test.1.xxxx...` 와 같은 접두사를 통해 어떤 컨테이너에서 발생한 로그인지 구분할 수 있습니다.
```

**4) Manager Node: `-f` 옵션으로 실시간 로그 확인**
`-f` 또는 `--follow` 옵션을 추가하면, 새로운 로그가 발생할 때마다 실시간으로 화면에 출력해줍니다.

```bash
timeout 10 docker service logs -f nginx-log-test
```

```tech
docker, swarm
```

```desc
#### ⏱️ 실시간 로그 스트리밍
`-f` 옵션을 사용하면, 서비스에서 발생하는 로그를 실시간으로 계속해서 화면에 출력합니다.

- **`-f`** 또는 **`--follow`**: 로그 스트림을 계속 따라가며 출력
- **`timeout 10 ...`**: 10초 후에 명령어 실행을 자동으로 중단

> 💡 서비스의 동작을 실시간으로 디버깅하거나 모니터링할 때 매우 유용한 기능입니다.
```

**5) 실습 종료**

```bash
: quit
```

```tech
bash,rocky
```

```desc
#### 👋 실습 종료
실습을 종료를 의미하는 `quit` 명령어를 실행합니다.
현재 터미널 세션을 종료합니다.

> 💡 모든 실습을 마친 후 사용합니다.
```