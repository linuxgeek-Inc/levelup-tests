##### Swarm: 설치 및 초기화 방법 #####


**1) Manager Node에 ssh로 접속**

```bash
ssh 192.168.0.2
```

```tech
ssh
```

```desc
#### 🖥️ Manager 노드 접속
SSH를 사용하여 Swarm 클러스터의 관리자 역할을 할 서버에 접속합니다.

- **`ssh`**: 원격 서버에 안전하게 접속하기 위한 명령어
- **`192.168.0.2`**: 접속할 관리자 노드의 IP 주소

> 💡 Swarm 클러스터를 구성하려면 먼저 작업을 지시할 관리자 노드에 접속해야 합니다.
```

**2) Manager Node: Swarm 초기화**
아래 명령어를 실행하여 Swarm을 초기화합니다.

```bash
docker swarm init --advertise-addr 192.168.0.2
```

```tech
docker, swarm
```

```desc
#### 🚀 Swarm 클러스터 초기화
현재 노드를 Swarm의 관리자(Manager) 노드로 만듭니다.

- **`docker swarm init`**: Swarm을 생성하고 현재 노드를 매니저로 설정
- **`--advertise-addr`**: 다른 노드들이 매니저에게 접속할 때 사용할 IP 주소를 지정

> ⚠️ 이 명령을 실행하면, 다른 작업자(Worker) 노드들이 클러스터에 참여할 때 필요한 토큰이 생성됩니다.
```

**3) Manager Node: 토큰을 파일에 저장.**

```bash
docker swarm join-token -q worker > /tmp/swarm_worker_token
```

```tech
docker, swarm
```

```desc
#### 🔑 Worker 참여 토큰 저장
작업자(Worker) 노드가 Swarm에 참여할 때 필요한 비밀 토큰을 파일에 저장합니다.

- **`docker swarm join-token`**: 참여 토큰을 보여주는 명령어
- **`-q worker`**: 작업자용 토큰만 조용히(quietly) 출력
- **`>`**: 명령어 결과를 파일로 저장(리다이렉션)

> 💡 토큰을 파일로 저장해두면 다른 노드에 전달하기 편리합니다.
```

**4) Manager Node 나가기**

```bash
exit
```

```tech
ssh
```

```desc
#### 🚪 Manager 노드에서 나가기
현재 접속한 관리자 노드와의 SSH 연결을 종료합니다.

- **`exit`**: 현재 셸 세션을 종료하는 명령어

> 💡 이제 작업자 노드에 접속하여 Swarm에 참여시킬 차례입니다.
```

**5) Worker Node에 ssh로 접속**

```bash
ssh 192.168.0.3
```

```tech
ssh
```

```desc
#### 🖥️ Worker 노드 접속
Swarm 클러스터에서 작업자(Worker) 역할을 할 서버에 접속합니다.

- **`ssh`**: 원격 서버 접속 명령어
- **`192.168.0.3`**: 접속할 작업자 노드의 IP 주소

> 💡 작업자 노드는 관리자 노드의 지시를 받아 실제 컨테이너를 실행하는 역할을 합니다.
```

**6) Worker Node: scp 명령어로 토큰 가져오기**

```bash
scp reallinux@192.168.0.2:/tmp/swarm_worker_token ./
```

```tech
scp
```

```desc
#### 📂 토큰 파일 복사
`scp`를 사용하여 관리자 노드에 저장해 둔 참여 토큰 파일을 현재 작업자 노드로 복사합니다.

- **`scp`**: 원격 서버와 파일을 안전하게 복사하는 명령어
- **`reallinux@192.168.0.2:...`**: 원본 파일 위치 (사용자@서버IP:경로)
- **`./`**: 복사해올 위치 (현재 디렉터리)

> 💡 `scp`는 SSH를 기반으로 동작하므로, SSH 접속이 가능하다면 `scp`도 사용할 수 있습니다.
```

**7) Worker Node: Swarm 참여**

```bash
docker swarm join --token $(cat ./swarm_worker_token) 192.168.0.2:2377
```

```tech
docker, swarm
```

```desc
#### 🤝 Swarm 클러스터에 참여
복사해 온 토큰을 사용하여 현재 작업자 노드를 Swarm 클러스터에 합류시킵니다.

- **`docker swarm join`**: Swarm에 참여하는 명령어
- **`--token $(cat ...)`**: 파일의 내용을 읽어 토큰으로 사용
- **`192.168.0.2:2377`**: 관리자 노드의 주소와 Swarm 포트

> 💡 "This node joined a swarm as a worker." 메시지가 나타나면 성공입니다.
```

**8) Worker Node 나가기**

```bash
exit
```

```tech
ssh
```

```desc
#### 🚪 Worker 노드에서 나가기
작업자 노드 설정을 마친 후 SSH 연결을 종료합니다.

- **`exit`**: 현재 셸 세션 종료

> 💡 이제 다시 관리자 노드로 돌아가 클러스터 상태를 확인할 차례입니다.
```

**9) 다시 Manager Node로 복귀**

```bash
ssh 192.168.0.2
```

```tech
ssh
```

```desc
#### 🖥️ Manager 노드로 복귀
클러스터 상태를 확인하기 위해 다시 관리자 노드로 접속합니다.

- **`ssh`**: 원격 서버 접속 명령어
- **`192.168.0.2`**: 관리자 노드의 IP 주소

> 💡 클러스터 관리는 항상 관리자 노드에서 수행합니다.
```

**10) Manager Node: 클러스터 노드 상태 확인**
관리자 노드에서 `docker node ls` 명령어를 사용하여 클러스터에 포함된 모든 노드의 상태를 확인합니다.

```bash
docker node ls
```

```tech
docker, swarm
```

```desc
#### 📋 클러스터 노드 목록 확인
현재 Swarm 클러스터에 포함된 모든 노드(관리자, 작업자)의 목록과 상태를 확인합니다.

- **`docker node ls`**: 클러스터의 모든 노드를 나열하는 명령어
- **`STATUS`**: `Ready`는 노드가 정상 작동 중임을 의미
- **`AVAILABILITY`**: `Active`는 노드가 작업을 받을 수 있음을 의미

> 💡 방금 추가한 작업자 노드가 목록에 보이면 성공적으로 클러스터가 구성된 것입니다.
```

**11) Manager Node: 10초간 노드 상태 실시간 모니터링**
`watch` 명령어를 사용하여 10초 동안 2초 간격으로 노드 상태를 실시간으로 모니터링합니다. 10초 후 자동으로 종료됩니다.

```bash
timeout 10s watch -n 2 docker node ls
```

```tech
docker, swarm
```

```desc
#### ⏱️ 노드 상태 실시간 모니터링
`watch`를 이용해 `docker node ls` 명령어를 주기적으로 실행하여 노드 상태 변화를 실시간으로 관찰합니다.

- **`timeout 10s`**: 10초 후에 명령어 실행을 중단
- **`watch -n 2`**: 2초마다 지정된 명령어를 반복 실행

> 💡 노드가 추가되거나 떠날 때, 또는 상태가 바뀔 때 동적으로 확인하는 데 유용합니다.
```

**12) 실습 종료**

```bash
: quit
```

```tech
bash,rocky
```

```desc
#### 👋 실습 종료
실습을 종료를 의미하는 `quit` 명령어를 실행합니다.
현재 터미널 세션을 종료합니다.

> 💡 모든 실습을 마친 후 사용합니다.
```