##### 프로세스가 호출하는 시스템콜 보려면?#####

**1) 새로운 프로세스 실행과 동시에 시스템콜 추적**

```bash
strace -c ls
```

```tech
strace,bash,rocky
```

```desc
#### 📊 시스템콜 호출 통계 보기
`strace`를 이용해 `ls` 명령어가 실행되는 동안 어떤 시스템콜이 몇 번 호출되었는지 요약해서 보여줍니다.

- **`strace -c`**: 명령어 실행이 끝난 후 시스템콜 호출 횟수, 오류, 소요 시간 등 통계 정보를 출력
- **`ls`**: 추적할 대상 명령어

> 💡 `-c` 옵션은 전체적인 호출 패턴을 파악하거나 성능 문제를 분석할 때 유용합니다.
```

**2) 테스트용 프로세스(sleep 300) 백그라운드 실행**

```bash
sleep 300 &
```

```tech
bash,rocky
```

```desc
#### ⏳ 추적할 테스트 프로세스 실행
`strace`로 붙여볼(attach) 대상 프로세스로, 300초 동안 아무 작업도 하지 않고 대기하는 `sleep` 명령어를 백그라운드에서 실행합니다.

- **`sleep 300`**: 300초 동안 대기
- **`&`**: 백그라운드에서 실행하여 다른 작업을 계속할 수 있게 함

> 💡 이렇게 실행해두면 `strace`가 해당 프로세스에 붙어 동작을 감시할 수 있습니다.
```

**3) 프로세스 이름(sleep)으로 PID 찾아 일정 시간(예: 10초) 동안 시스템콜 추적 로그파일에 저장**

```bash
sudo timeout 10 strace -o trace.log -p $(pgrep sleep)
```

```tech
timeout,pgrep,strace,bash,rocky
```

```desc
#### 🕵️ 실행 중인 프로세스 시스템콜 추적하기
이미 실행 중인 `sleep` 프로세스에 `strace`를 붙여 10초 동안의 시스템콜을 `trace.log` 파일에 기록합니다.

- **`sudo`**: 다른 사용자의 프로세스를 추적하려면 관리자 권한 필요
- **`timeout 10`**: 10초 후에 `strace` 명령을 자동으로 종료
- **`strace -o trace.log`**: 추적 결과를 `trace.log` 파일에 저장
- **`-p $(pgrep sleep)`**: `pgrep`으로 찾은 `sleep` 프로세스의 PID에 `strace`를 붙임

> 💡 이 방법을 사용하면 서비스 중인 데몬이나 응답 없는 프로세스의 내부 동작을 분석할 수 있습니다.
```

**4) 로그파일에서 처음 50줄만 확인**

```bash
head -n 50 trace.log
```
```no-err-check
```

```tech
bash,rocky
```

```desc
#### 📜 추적 로그 파일 내용 확인
`head` 명령어로 `strace`가 기록한 로그 파일(`trace.log`)의 앞부분 50줄을 확인합니다.

- **`head -n 50`**: 파일의 첫 부분부터 50라인까지 출력
- **`trace.log`**: `strace`가 생성한 로그 파일

> 💡 `sleep` 프로세스는 대부분 `nanosleep`이라는 시스템콜을 호출하며 대기 상태에 있는 것을 볼 수 있습니다.
```

**5) ls 명령어 실행하며 상세한 시스템콜 추적 (시간, 프로세스 ID, 추적 깊이 옵션 추가)**

```bash
strace -tt -T -f -e trace=open,read,write ls
```

```tech
strace,bash,rocky
```

```desc
#### 🔍 특정 시스템콜만 상세히 추적하기
`ls` 명령어를 실행하면서 `open`, `read`, `write` 시스템콜만 추적하고, 각 호출에 대한 상세 정보를 함께 출력합니다.

- **`-tt`**: 마이크로초 단위의 시간 정보 표시
- **`-T`**: 각 시스템콜이 소요된 시간 표시
- **`-f`**: 자식 프로세스까지 모두 추적
- **`-e trace=open,read,write`**: `open`, `read`, `write` 시스템콜만 추적 대상으로 지정

> 💡 특정 동작(예: 파일 열기, 읽기)과 관련된 문제를 분석할 때 매우 유용합니다.
```

**6) 테스트용 sleep 프로세스 종료**

```bash
sudo kill $(pgrep sleep)
```

```tech
pgrep,kill,bash,rocky
```

```desc
#### 🧹 테스트 프로세스 정리하기
`strace` 추적 테스트를 위해 실행했던 `sleep` 프로세스를 `kill` 명령어로 종료합니다.

- **`sudo kill`**: 프로세스에 종료 신호를 보냄
- **`$(pgrep sleep)`**: `pgrep`으로 `sleep` 프로세스의 PID를 찾아 전달

> 💡 테스트나 디버깅을 위해 생성했던 임시 프로세스는 작업이 끝난 후 정리하는 것이 좋습니다.
```
