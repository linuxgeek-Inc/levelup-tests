##### 구글 웹서버 TCP 네트워크 추적하기 #####

**1) Wireshark CLI 도구 설치**

```bash
sudo dnf install -y wireshark-cli
```

```tech
sudo,dnf,install,wireshark-cli,bash,rocky
```

```desc
#### 📦 tshark(Wireshark CLI) 설치
`sudo dnf install -y wireshark-cli`는 네트워크 패킷 분석 도구인 Wireshark의 CLI 버전, `tshark`를 설치합니다.

- **sudo**: 관리자 권한으로 실행합니다.
- **dnf install -y**: Rocky Linux에서 패키지를 설치하며, 모든 확인 프롬프트에 자동으로 'yes'로 답합니다.

> 💡 GUI 없이 터미널 환경에서 네트워크 패킷을 캡처하고 분석할 때 필수적인 도구입니다. 이미 설치되어 있다면 이 단계는 생략될 수 있습니다.
```

**2) tshark 명령어 설명 확인**

```bash
whatis tshark
```

```tech
whatis,tshark,bash,rocky
```

```desc
#### 📖 tshark 명령어 설명 확인
`whatis tshark`는 `tshark` 명령어가 무엇인지 간단한 설명을 보여줍니다. 네트워크 트래픽을 캡처하고 분석하는 강력한 도구입니다.

- **출력 내용**: `tshark` 명령어에 대해 짧은 설명
- **Wireshark CLI**: GUI 버전의 Wireshark와 동일한 기능을 터미널에서 제공합니다.

> 💡 서버 환경에서 실시간으로 네트워크 문제를 진단할 때 매우 유용합니다.
```

**3) 1초간 TCP 80번 포트 패킷 추적**

* 참고: `TCP`(port: 80) 통신이 **없다면 추적결과도 없다**

```bash
sudo tshark -i eth0 -f "tcp port 80" -a duration:1
```

```tech
sudo,tshark,bash,rocky
```

```desc
#### 🔍 TCP 80 포트 패킷 캡처 (사전 확인)
`sudo tshark ...` 명령어는 1초 동안 `eth0` 인터페이스에서 TCP 80번 포트를 사용하는 패킷을 캡처합니다. 아직 아무런 요청을 보내지 않았기 때문에 아무 패킷도 잡히지 않는 것을 확인하기 위한 단계입니다.

- **-i eth0**: `eth0` 네트워크 인터페이스를 지정합니다.
- **-f "tcp port 80"**: TCP 프로토콜의 80번 포트(HTTP) 트래픽만 캡처하는 필터입니다.
- **-a duration:1**: 1초 동안만 캡처를 실행합니다.

> 💡 특정 작업을 수행하기 전과 후의 네트워크 상태를 비교하면 문제의 원인을 파악하는 데 도움이 됩니다.
```

**4) 10초간 TCP 80번 포트 패킷 캡처**

```bash
sudo tshark -i eth0 -f "tcp port 80" -a duration:10 2> /dev/null > tcp.log &
```

```tech
sudo,tshark,bash,rocky
```

```desc
#### 🕵️‍ 백그라운드에서 TCP 패킷 캡처 시작
`sudo tshark ... &` 명령어는 10초 동안 TCP 80번 포트 트래픽을 캡처하여 `tcp.log` 파일에 저장하는 작업을 백그라운드에서 시작합니다.

- **-a duration:10**: 10초 동안 캡처를 실행합니다.
- **2> /dev/null > tcp.log**: 표준 오류는 버리고, 표준 출력(캡처 결과)은 `tcp.log` 파일에 저장합니다.
- **&**: 명령어를 백그라운드에서 실행시켜, 캡처가 진행되는 동안 다른 명령어를 입력할 수 있게 합니다.

> 💡 백그라운드 실행은 실시간으로 발생하는 이벤트를 관찰하면서 동시에 해당 이벤트를 유발하는 작업을 수행할 때 필수적입니다.
```

**5) www.google.com에 HTTP 요청**

```bash
curl www.google.com
```

```tech
curl,bash,rocky
```

```desc
#### 🌐 HTTP 요청으로 TCP 트래픽 유발
`curl www.google.com` 명령어는 `www.google.com`의 웹 페이지 내용을 가져옵니다. 이 요청은 기본적으로 HTTP 프로토콜(TCP 80번 포트)을 사용하므로, 백그라운드에서 실행 중인 `tshark`가 이 트래픽을 캡처하게 됩니다.

- **TCP 3-way handshake**: 이 요청으로 인해 클라이언트와 서버 간에 TCP 연결을 맺는 과정(SYN, SYN-ACK, ACK)이 발생합니다.
- **HTTP GET**: 실제 웹 데이터를 요청하는 패킷이 전송됩니다.

> 💡 `curl`은 특정 네트워크 트래픽을 인위적으로 발생시켜 테스트할 때 매우 유용한 도구입니다.
```

**6) 캡처된 TCP 로그 확인**

```bash
sleep 8 && cat tcp.log
```

```tech
sleep,cat,bash,rocky
```

```desc
#### 📄 로그 파일 내용 확인
`tshark`가 10초 동안 캡처를 완료할 시간을 충분히 주기 위해 8초간 기다린(`sleep 8`) 후, `tcp.log` 파일의 내용을 출력(`cat tcp.log`)합니다.

- **sleep 8**: 8초 동안 대기합니다.
- **&&**: 앞의 명령이 성공하면 뒤의 명령을 실행합니다.
- **cat tcp.log**: `tcp.log` 파일의 내용을 터미널에 출력합니다.

> 💡 `curl` 요청으로 발생한 TCP 3-way handshake 과정(SYN, SYN-ACK, ACK)과 HTTP GET 요청 및 응답 패킷들을 직접 눈으로 확인할 수 있습니다.
```

**7) 실습 종료**

```bash
: quit
```

```tech
bash,rocky
```

```desc
#### 👋 실습 종료
실습을 종료를 의미하는 `quit` 명령어를 실행합니다.
현재 터미널 세션을 종료합니다.

> 💡 모든 실습을 마친 후 사용합니다.
```
