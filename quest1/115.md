##### ping ICMP 네트워크 추적하기 #####

**1) ping 명령어 설명 확인**

```bash
whatis ping
```

```tech
whatis,ping,bash,rocky
```

```desc
#### 📖 ping 명령어 설명 확인
`whatis ping`은 `ping` 명령어가 무엇인지 간단하게 설명해줍니다. 네트워크 호스트에 ICMP ECHO_REQUEST 패킷을 보내 응답을 확인하는 역할을 합니다.

- **출력 내용**: `ping` 명령어에 대한 짧은 설명
- **네트워크 진단**: 네트워크 연결 상태를 확인하는 가장 기본적인 도구입니다.

> 💡 특정 서버나 웹사이트가 응답하는지 확인할 때 가장 먼저 사용하는 명령어입니다.
```

**2) Google DNS 서버로 백그라운드 ping 실행**

```bash
ping -q 8.8.8.8 &
```

```tech
ping,bash,rocky
```

```desc
#### 🌐 백그라운드에서 ping 실행
`ping -q 8.8.8.8 &` 명령어는 Google의 공용 DNS 서버(8.8.8.8)에 조용히(-q) ping을 보내면서, 백그라운드(&)에서 계속 실행되도록 합니다.

- **-q**: 요약된 출력만 보여주어 터미널이 깨끗하게 유지됩니다.
- **&**: 명령어를 백그라운드에서 실행시켜 다른 작업을 계속할 수 있습니다.

> 💡 네트워크 패킷을 지속적으로 발생시켜놓고 다른 도구로 해당 패킷을 관찰할 때 유용합니다.
```

**3) Wireshark CLI 도구 설치**

```bash
sudo dnf install -y wireshark-cli
```

```tech
sudo,dnf,install,wireshark-cli,bash,rocky
```

```desc
#### 📦 tshark(Wireshark CLI) 설치
`sudo dnf install -y wireshark-cli`는 네트워크 패킷 분석 도구인 Wireshark의 CLI 버전, `tshark`를 설치합니다.

- **sudo**: 관리자 권한으로 실행합니다.
- **dnf install -y**: Rocky Linux에서 패키지를 설치하며, 모든 확인 프롬프트에 자동으로 'yes'로 답합니다.

> 💡 GUI 없이 터미널 환경에서 네트워크 패킷을 캡처하고 분석할 때 필수적인 도구입니다.
```

**4) tshark 명령어 설명 확인**

```bash
whatis tshark
```

```tech
whatis,tshark,bash,rocky
```

```desc
#### 📖 tshark 명령어 설명 확인
`whatis tshark`는 `tshark` 명령어가 무엇인지 간단한 설명을 보여줍니다. 네트워크 트래픽을 캡처하고 분석하는 강력한 도구입니다.

- **출력 내용**: `tshark` 명령어에 대한 짧은 설명
- **Wireshark CLI**: GUI 버전의 Wireshark와 동일한 기능을 터미널에서 제공합니다.

> 💡 서버 환경에서 실시간으로 네트워크 문제를 진단할 때 매우 유용합니다.
```

**5) Google DNS와 통신하는 ICMP 패킷 캡처**

```bash
sudo timeout 5 tshark -i eth0 -f icmp -Y "ip.dst == 8.8.8.8 or ip.src == 8.8.8.8"
```

```tech
sudo,timeout,tshark,bash,rocky
```

```desc
#### 🔍 ICMP 패킷 캡처 (Google DNS)
`sudo timeout 5 tshark ...` 명령어는 5초 동안 `eth0` 네트워크 인터페이스에서 ICMP 프로토콜만 필터링하여 Google DNS(8.8.8.8)와 주고받는 패킷을 캡처합니다.

- **timeout 5**: 5초 후에 명령어를 자동으로 종료합니다.
- **-i eth0**: `eth0` 네트워크 인터페이스를 지정합니다.
- **-f icmp**: ICMP 프로토콜만 캡처하도록 필터링합니다.
- **-Y "..."**: 출력 필터로, 출발지 또는 목적지 IP가 8.8.8.8인 패킷만 보여줍니다.

> 💡 이전에 백그라운드로 실행한 `ping` 명령으로 인해 발생하는 ICMP 요청(Echo request)과 응답(Echo reply) 패킷을 실시간으로 확인할 수 있습니다.
```

**6) 백그라운드 ping 프로세스 종료**

```bash
pkill ping
```

```tech
pkill,ping,bash,rocky
```

```desc
#### 🛑 백그라운드 ping 종료
`pkill ping` 명령어는 현재 실행 중인 모든 `ping` 프로세스를 찾아 종료합니다.

- **pkill**: 프로세스 이름을 기반으로 프로세스를 종료시키는 명령어입니다.

> 💡 백그라운드에서 실행되던 `ping`을 깔끔하게 정리할 때 사용합니다.
```

**7) ICMP 패킷 다시 캡처 (ping 종료 후)**

```bash
sudo timeout 5 tshark -i eth0 -f icmp -Y "ip.dst == 8.8.8.8 or ip.src == 8.8.8.8"
```

```tech
sudo,timeout,tshark,bash,rocky
```

```desc
#### 텅 빈 캡처 확인
`pkill`로 `ping` 프로세스를 종료했기 때문에 더 이상 ICMP 패킷이 발생하지 않습니다. 이 상태에서 다시 `tshark`로 캡처를 시도하면 5초 동안 아무런 패킷도 잡히지 않는 것을 확인할 수 있습니다.

- **패킷 없음**: `ping`이 중단되었으므로 ICMP 요청/응답이 없습니다.

> 💡 특정 프로세스가 네트워크 트래픽을 발생시키는지 여부를 확인할 때 유용한 비교 방법입니다.
```

**8) bind-utils 패키지 설치**

```bash
sudo dnf install -y bind-utils
```

```tech
sudo,dnf,install,bind-utils,bash,rocky
```

```desc
#### 📦 dig 명령어 도구 설치
`sudo dnf install -y bind-utils`는 `dig`, `nslookup` 등 DNS 관련 도구가 포함된 `bind-utils` 패키지를 설치합니다.

- **sudo**: 관리자 권한으로 실행합니다.
- **dnf install -y**: Rocky Linux에서 패키지를 설치하며, 모든 확인 프롬프트에 자동으로 'yes'로 답합니다.
- **bind-utils**: `dig` 명령어를 사용하기 위해 필요한 패키지입니다.

> 💡 `dig` 명령어가 시스템에 없을 경우, 이 패키지를 먼저 설치해야 합니다.
```

**9) www.naver.com의 IP 주소 확인 및 변수 저장**

```bash
NAVER=$(dig +short www.naver.com | grep -E '^[0-9]+\.' | head -n 1)
```

```tech
dig,grep,head,bash,rocky
```

```desc
#### 🌐 도메인 IP 주소 조회
`dig` 명령어로 'www.naver.com'의 IP 주소를 조회하고, 파이프라인(`|`)을 통해 가공하여 `NAVER`라는 셸 변수에 저장합니다.

- **dig +short**: 도메인에 대한 IP 주소만 간결하게 출력합니다.
- **grep -E '^[0-9]+\.'**: 숫자로 시작하는 IP 주소 형식의 라인만 필터링합니다.
- **head -n 1**: 여러 IP 주소 중 첫 번째 주소만 선택합니다.
- **NAVER=$(...)**: dig 명령어 실행결과 네이버 IP 주소를 `NAVER` 변수에 할당합니다.

> 💡 스크립트에서 도메인 이름 대신 IP 주소를 사용해야 할 때 동적으로 주소를 가져오는 일반적인 방법입니다.
```

**10) 저장된 NAVER IP 주소 확인**

```bash
echo $NAVER
```

```tech
echo,bash,rocky
```

```desc
#### 🖥️ 변수 내용 출력
`echo $NAVER`는 `NAVER` 변수에 저장된 값을 화면에 출력합니다. 'www.naver.com'의 IP 주소가 올바르게 저장되었는지 확인할 수 있습니다.

- **$NAVER**: `NAVER` 변수의 값을 참조합니다.

> 💡 변수에 값이 제대로 할당되었는지 디버깅하는 가장 기본적인 방법입니다.
```

**11) NAVER 서버로 백그라운드 ping 실행**

```bash
ping -q $NAVER &
```

```tech
ping,bash,rocky
```

```desc
#### 🚀 NAVER 서버에 ping 실행
`ping -q $NAVER &` 명령어는 이전에 조회한 NAVER의 IP 주소로 백그라운드에서 조용히 ping을 보냅니다.

- **$NAVER**: 변수에 저장된 IP 주소를 사용합니다.

> 💡 변수를 활용하여 동적으로 대상을 지정하는 방법을 보여줍니다.
```

**12) NAVER와 통신하는 ICMP 패킷 캡처**

```bash
sudo timeout 5 tshark -i eth0 -f icmp -Y "ip.dst == $NAVER or ip.src == $NAVER"
```

```tech
sudo,timeout,tshark,bash,rocky
```

```desc
#### 🔍 ICMP 패킷 캡처 (NAVER)
`sudo timeout 5 tshark ...` 명령어는 5초 동안 NAVER 서버와 주고받는 ICMP 패킷을 캡처합니다.

- **-Y "ip.dst == $NAVER or ip.src == $NAVER"**: 출발지 또는 목적지 IP가 `$NAVER` 변수의 값과 일치하는 패킷만 필터링하여 보여줍니다.

> 💡 `ping`과 `tshark`를 함께 사용하여 특정 대상과의 네트워크 통신이 실제로 어떻게 이루어지는지 눈으로 직접 확인할 수 있습니다.
```

**13) 실습 종료**

```bash
: quit
```

```tech
bash,rocky
```

```desc
#### 👋 실습 종료
실습을 종료를 의미하는 `quit` 명령어를 실행합니다.
현재 터미널 세션을 종료합니다.

> 💡 모든 실습을 마친 후 사용합니다.
```
