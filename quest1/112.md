##### Nginx 403 Permission denied 권한 오류 해결하기#####

**1) Nginx 웹서버 설치**

```bash
sudo dnf install -y nginx
````

```tech
nginx,dnf
```

```desc
#### 📦 Nginx 설치하기
Rocky Linux 9 환경에서 `dnf`를 이용해 Nginx를 설치합니다.

- **`dnf install -y nginx`** : 설치 중 묻는 질문을 자동으로 `yes` 처리
- 설치 완료 후 기본 웹 루트는 `/usr/share/nginx/html`

> 💡 설치 후 `systemctl start nginx` 명령으로 서비스를 시작할 수 있습니다.
```

**2) Nginx 실행**

```bash
sudo systemctl start nginx
```

```tech
nginx,service
```

```desc
#### ▶️ Nginx 실행
Nginx 서비스를 실행합니다.

- **`systemctl start nginx`** : 서비스 시작

> 💡 `active (running)` 상태면 정상 실행 중입니다.
```

**3) Nginx 상태 확인**

```bash
sudo systemctl status nginx
```

```tech
nginx,service
```

```desc
#### ▶️ Nginx 상태 확인
Nginx 서비스 상태를 점검합니다.

- **`systemctl status nginx`** : 현재 상태 확인

> 💡 `active (running)` 상태면 정상 실행 중입니다.
```

**4) 프로젝트 디렉터리 생성**

```bash
mkdir -p /home/reallinux/project
```

```tech
nginx,filesystem
```

```desc
#### 📁 프로젝트 디렉터리 생성
홈 디렉터리 아래 `project` 폴더를 만듭니다.

- `/home/reallinux/project`

> ⚠️ 아직 접근 권한 설정은 하지 않았습니다.
```

**5) 프로젝트 HTML 파일 생성**

```bash
echo "Hello from Project!" > /home/reallinux/project/index.html
```

```tech
nginx,filesystem
```

```desc
#### 📁 테스트용 `index.html`을 생성
- `/home/reallinux/project/index.html`
- 파일 내용: "Hello from Project!"

> ⚠️ 아직 접근 권한 설정은 하지 않았습니다.
```

**6) Nginx 설정파일 수정**

```bash
sudo bash -c 'cat > /etc/nginx/conf.d/project.conf <<EOF
server {
    listen       80;
    server_name  localhost;
    root         /home/reallinux/project;
    index        index.html;
}
EOF'
```

```tech
nginx,config
```

```desc
#### ⚙️ Nginx 설정 수정
Nginx가 `/home/reallinux/project` 경로를 서비스하도록 설정합니다.

- **`root`** : 웹 문서 루트 디렉터리
- **`index`** : 기본 제공할 파일 지정

> 💡 설정 후 반드시 `nginx -t`로 문법 확인을 해야 합니다.
```

**7) Nginx 설정 테스트**

```bash
sudo nginx -t
```

```tech
nginx
```

```desc
#### 🔄 설정 적용
- **`nginx -t`** : 설정 파일 문법 검사

> ✅ 문법이 정상이라면 `syntax is ok` 메시지가 출력됩니다.
```

**8) Nginx 재시작**

```bash
sudo systemctl reload nginx
```

```tech
nginx
```

```desc
#### 🔄 설정 적용
- **`systemctl reload nginx`** : 서비스 재시작 없이 설정 반영
```

**9) 웹 접속 시 403 오류 발생 확인**

```bash
curl -I http://localhost
```

```tech
nginx,curl
```

```desc
#### 🚫 403 Forbidden 오류 확인
Nginx가 `/home/reallinux/project/index.html`에 접근할 수 없는 경우 403 Forbidden 발생.

- `HTTP/1.1 403 Forbidden` 헤더 확인
- index.html 권한이 777이어도 오류 발생 가능

> ⚠️ 상위 폴더의 실행(`x`) 권한이 없으면 접근 불가합니다.
```

**10) 폴더 권한 확인**

```bash
ls -ld /home/reallinux /home/reallinux/project
```

```tech
permissions
```

```desc
#### 🔍 폴더 권한 확인
- **`ls -ld`** : 폴더 권한 확인
```

**11) 파일 권한 확인**

```bash
ls -l /home/reallinux/project/index.html
```

```tech
permissions
```

```desc
#### 🔍 파일 권한 확인
- **`ls -l`** : 파일 권한 확인
```

**12) ACL 권한 확인**

```bash
getfacl /home/reallinux
```

```tech
acl
```

```desc
#### 🔍 ACL 기반 권한 상세 확인
- **`getfacl`** : ACL 기반 권한 상세 확인

> 💡 index.html은 `-rwxrwxrwx` (777)이라도 상위폴더에 `x`권한 없으면 접근 불가합니다.
```

**13) Nginx 계정이 속한 그룹 확인**

```bash
id nginx
```

```tech
nginx,permissions
```

```desc
#### 👤 Nginx 실행 계정 확인
웹서버가 어떤 계정/그룹으로 동작하는지 확인합니다.

- 기본적으로 `nginx` 사용자, `nginx` 그룹 소속
- `/home/reallinux` 디렉터리에 접근할 권한이 없음

> ⚠️ 홈 디렉터리에는 기본적으로 다른 사용자 접근이 차단되어 있습니다.
```

**14) Nginx를 reallinux 그룹에 추가**

```bash
sudo usermod -aG reallinux nginx
```

```tech
usermod,permissions
```

```desc
#### 👥 Nginx 계정 그룹 추가
nginx 사용자를 `reallinux` 그룹에 포함시켜 접근 권한을 부여합니다.

- **`usermod -aG`** : 보조 그룹에 계정 추가
- 적용 후 Nginx 재시작 필요

> 💡 그룹 변경 후 `id nginx`로 반영 여부 확인 가능합니다.
```

**15) 상위 폴더에 실행 권한 부여 전 상태 확인**

```bash
getfacl /home/reallinux
```

```tech
chmod,permissions
```

```desc
#### 🛠 권한 변경 전 상태 확인
`chmod` 명령으로 권한을 변경하기 전 `getfacl`로 현재 상태를 확인합니다.
```

**16) 상위 폴더에 실행 권한 부여**

```bash
sudo chmod g+x /home/reallinux
```

```tech
chmod,permissions
```

```desc
#### 🛠 상위 폴더 실행 권한 부여
그룹 사용자(`reallinux`)가 홈 디렉터리 내부로 진입할 수 있도록 `x` 권한 추가.

- **`chmod g+x`** : 그룹 실행 권한 추가
- 이후 Nginx가 index.html 접근 가능
```

**17) 상위 폴더에 실행 권한 부여 후 상태 확인**

```bash
getfacl /home/reallinux
```

```tech
chmod,permissions
```

```desc
#### 🛠 권한 변경 후 상태 확인
`chmod` 명령으로 권한을 변경한 후 `getfacl`로 변경된 상태를 확인합니다.

> ✅ `curl http://localhost` 실행 시 정상 페이지 확인 가능
```

**18) 권한 문제 두 번째 해결 방법**

```bash
sudo mkdir -p /var/www/html
```

```tech
nginx,filesystem
```

```desc
#### 📦 문서 루트를 표준 경로로 변경
Nginx 기본 문서 루트 `/var/www/html`에 `index.html`을 옮겨 권한 문제를 해결합니다.
```

**19) 프로젝트 파일 이동**

```bash
sudo mv /home/reallinux/project/index.html /var/www/html/index.html
```

```tech
nginx,filesystem
```

```desc
#### 📦 문서 루트를 표준 경로로 변경
- 표준 경로는 웹서버 계정 접근이 허용됨
- 별도의 그룹/권한 추가 불필요

> 💡 이 방식이 보안상 더 안전합니다.
```

**20) Nginx 설정 복구**

```bash
sudo rm -f /etc/nginx/conf.d/project.conf
```

```tech
nginx,config
```

```desc
#### 🔄 설정 원상복구
커스텀 설정 제거 후 Nginx를 재시작합니다.
```

**21) Nginx 재시작**

```bash
sudo systemctl reload nginx
```

```tech
nginx,config
```

```desc
#### 🔄 설정 원상복구
- 기본 설정(`/usr/share/nginx/html`) 또는 `/var/www/html`이 서비스 루트
- 이후 403 오류 없이 정상 접근 가능
```

**22) index.html 권한 원래대로 복구 전 상태 확인**

```bash
getfacl /var/www/html/index.html
```

```tech
chmod
```

```desc
#### ✅ 파일 권한 원상복구 전 상태 확인
`chmod` 명령으로 권한을 변경하기 전 `getfacl`로 현재 상태를 확인합니다.
```

**23) index.html 권한 원래대로 복구**

```bash
sudo chmod 644 /var/www/html/index.html
```

```tech
chmod
```

```desc
#### ✅ 파일 권한 원상복구
`index.html`의 권한을 644로 되돌려 최소 권한 원칙을 적용합니다.

- `-rw-r--r--` : 소유자 읽기/쓰기, 그룹/기타 읽기만 허용
- 불필요한 777 권한 제거
```

**24) index.html 권한 원래대로 복구 후 상태 확인**

```bash
getfacl /var/www/html/index.html
```

```tech
chmod
```

```desc
#### ✅ 파일 권한 원상복구 후 상태 확인
`chmod` 명령으로 권한을 변경한 후 `getfacl`로 변경된 상태를 확인합니다.

> ⚠️ 보안상 웹 문서는 644 권한이 일반적이며, 실행 권한은 필요하지 않습니다.
```
