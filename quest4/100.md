##### K8s: Pod 재시작 후 변화된 상태 확인하기 #####

**1) 테스트용 Deployment 생성**
```bash
kubectl create deployment nginx-restart-test --image=nginx
```
```tech
bash,kubectl,kubernetes
```
```desc
#### 🚀 테스트용 Deployment 생성
실습을 위해 Nginx 이미지를 사용하는 간단한 Deployment를 생성합니다.

- **`kubectl create deployment`**: 새로운 Deployment를 만듭니다.
- **`nginx-restart-test`**: Deployment의 이름입니다.
- **`--image=nginx`**: 사용할 컨테이너 이미지입니다.

> 💡 Deployment는 Pod를 관리하며, Pod에 문제가 생겼을 때 자동으로 복구하는 역할을 합니다.
```

**2) 'prod' 네임스페이스에 Deployment가 준비 될 때까지 wait**
```bash
kubectl wait --for=condition=available deployment/nginx-restart-test --timeout=60s
```
```tech
kubectl
```
```desc
#### ⏳ Deployment 준비 대기
Deployment가 완전히 준비되어 사용 가능한 상태가 될 때까지 기다립니다.

- **`kubectl wait`**: 특정 조건이 충족될 때까지 대기합니다.
- **`--for=condition=available`**: 'Available' 상태가 될 때까지 기다리도록 설정합니다.
- **`deployment/nginx-restart-test`**: 대상 리소스입니다.
- **`--timeout=60s`**: 최대 60초까지만 기다립니다.

> ⚠️ 시간 내에 준비되지 않으면 오류가 발생하며, Pod의 상태를 점검해야 합니다.
```

**3) 초기 Pod 상태 확인**
```bash
kubectl get pods -l app=nginx-restart-test -o wide
```
```tech
bash,kubectl,kubernetes
```
```desc
#### 👀 초기 Pod 상태 확인
Deployment에 의해 생성된 Pod의 초기 상태를 확인합니다.

- **`kubectl get pods`**: Pod 목록을 조회합니다.
- **`-l app=nginx-restart-test`**: 'app' 레이블이 'nginx-restart-test'인 Pod만 필터링합니다.
- **`-o wide`**: IP, 노드 정보 등 더 많은 정보를 함께 표시합니다.

> 💡 `STATUS`가 `Running`이고 `READY`가 `1/1`이면 정상입니다.
```

**4) Pod 이름 변수 저장**
```bash
POD_NAME=$(kubectl get pods -l app=nginx-restart-test -o jsonpath='{.items[0].metadata.name}')
```
```tech
bash,echo,kubectl,kubernetes
```
```desc
#### 💾 Pod 이름 변수 저장
이후 명령어에서 사용하기 위해 Pod의 이름을 변수에 저장합니다.

- **`$()`**: 괄호 안의 명령어를 실행하고 결과를 반환합니다.
- **`-o jsonpath='{.items[0].metadata.name}'`**: JSON 출력 형식에서 특정 필드(첫 번째 아이템의 이름)만 추출합니다.

> 💡 스크립트 작성 시 반복적인 입력을 줄여주는 유용한 방법입니다.
```

```bash
echo "대상 Pod: $POD_NAME"
```
```tech
bash,echo,kubectl,kubernetes
```
```desc
#### 🗣️ 대상 Pod 이름 출력
변수에 저장된 Pod의 이름을 확인합니다.

- **`echo`**: 문자열이나 변수의 값을 출력합니다.
- **`$POD_NAME`**: `POD_NAME` 변수의 값을 참조합니다.

> 💡 명령어를 실행하기 전에 대상이 올바른지 확인하는 좋은 습관입니다.
```

**5) Pod 내부 프로세스 즉시 종료**
```bash
kubectl exec $POD_NAME -- nginx -s stop
```
```tech
bash,kubectl,kubernetes,pkill
```
```desc
#### 💥 Pod 내부 프로세스 강제 종료
Pod 안에서 실행 중인 Nginx 프로세스를 직접 종료시켜 비정상 상황을 만듭니다.

- **`kubectl exec`**: 실행 중인 컨테이너 내부에서 명령어를 실행합니다.
- **`$POD_NAME`**: 명령을 실행할 대상 Pod입니다.
- **`--`**: `kubectl` 명령어의 끝을 알리고, 뒤따라오는 것은 컨테이너 내부에서 실행할 명령어임을 명시합니다.
- **`nginx -s stop`**: Nginx 프로세스를 즉시 종료합니다.

> ⚠️ 이 명령은 컨테이너 자체를 삭제하는 것이 아니라, 내부의 메인 프로세스만 종료시킵니다.
```

**6) 재시작 후 상태 변화 확인**
```bash
timeout 10 watch kubectl get pods -l app=nginx-restart-test -o wide
```
```tech
bash,kubectl,kubernetes,watch
```
```desc
#### 🔄 재시작 후 상태 변화 확인
Pod가 어떻게 변화하는지 10초 동안 실시간으로 관찰합니다.

- **`watch`**: 주기적으로 명령어를 실행하여 결과를 전체 화면으로 보여줍니다.
- **`timeout 10`**: 10초 후에 `watch` 명령어를 종료합니다.

> 💡 `RESTARTS` 횟수가 증가하고, `AGE`가 초기화된 새로운 Pod가 생성되는 것을 볼 수 있습니다. 이것이 쿠버네티스의 자동 복구 기능입니다.
```

**7) Pod 상세 이벤트 확인**
```bash
kubectl describe pod $POD_NAME
```
```tech
bash,kubectl,kubernetes
```
```desc
#### 📜 Pod 상세 이벤트 확인
Pod의 상세 정보와 최근 발생한 이벤트 목록을 확인합니다.

- **`kubectl describe pod`**: Pod의 생성, 스케줄링, 상태 변화 등 상세한 정보를 보여줍니다.

> 💡 Pod가 왜 재시작되었는지, 어떤 문제가 있었는지 파악할 때 `Events` 섹션을 확인하는 것이 매우 중요합니다.
```

**8) 실습 자원 정리**
```bash
kubectl delete deployment nginx-restart-test
```
```tech
bash,kubectl,kubernetes
```
```desc
#### 🧹 실습 자원 정리
실습에 사용된 모든 리소스를 삭제합니다.

- **`kubectl delete deployment`**: Deployment를 삭제합니다.
- Deployment를 삭제하면 관련된 ReplicaSet과 Pod도 함께 삭제됩니다.

> 💡 실습이 끝나면 불필요한 리소스를 정리하여 클러스터 자원을 효율적으로 사용하는 것이 좋습니다.
```
