##### 오류 시나리오: MariaDB 패키지를 삭제했는데도 설정 파일이 남아있다?#####

**1) MariaDB 설치**

```bash
sudo apt install -y mariadb-server
```

```tech
apt
```

```desc
#### 📦 MariaDB 서버 설치하기
`apt` 패키지 관리자를 사용하여 MariaDB 데이터베이스 서버를 설치합니다.

- **`sudo`**: 관리자 권한으로 실행
- **`apt install`**: 패키지 설치 명령어
- **`-y`**: 설치 중 묻는 질문에 자동으로 'yes'로 응답
- **`mariadb-server`**: 설치할 패키지 이름

> 💡 MariaDB는 MySQL을 기반으로 만들어진 인기 있는 오픈소스 데이터베이스입니다.
```

**2) MariaDB 접속**

```bash
sudo mysql -s
```

```tech
mysql
```

```desc
#### 🖥️ MariaDB 접속하기
설치된 MariaDB 서버에 접속합니다.

- **`sudo`**: root 권한으로 접속하기 위해 필요
- **`mysql`**: MariaDB 및 MySQL 클라이언트 접속 명령어
- **`-s`**: `--silent` 옵션으로, 불필요한 정보 출력을 줄여 깔끔한 접속 화면을 보여줍니다.

> 💡 초기 설정에서는 root 계정에 비밀번호가 없어 `sudo`로 바로 접속할 수 있습니다.
```

**3) school 데이터베이스 생성**

```bash
CREATE DATABASE school;
```

```tech
mysql
```

```desc
#### 🏫 `school` 데이터베이스 생성하기
`school`이라는 이름의 새로운 데이터베이스를 만듭니다.

- **`CREATE DATABASE`**: 데이터베이스를 생성하는 SQL 구문
- **`school`**: 생성할 데이터베이스의 이름

> 💡 데이터베이스는 관련된 데이터들을 체계적으로 저장하고 관리하는 공간입니다.
```

**4) school 데이터베이스 사용**

```bash
USE school;
```

```tech
mysql
```

```desc
#### 🖱️ `school` 데이터베이스 사용하기
앞으로 수행할 SQL 명령의 대상을 `school` 데이터베이스로 지정합니다.

- **`USE`**: 사용할 데이터베이스를 선택하는 SQL 구문
- **`school`**: 선택할 데이터베이스 이름

> 💡 이 명령을 실행해야 해당 데이터베이스 안에 테이블을 만들거나 데이터를 조작할 수 있습니다.
```

**5) students 테이블 생성**

```bash
CREATE TABLE students (id INT PRIMARY KEY AUTO_INCREMENT, name VARCHAR(50), age INT);
```

```tech
mysql
```

```desc
#### 📝 `students` 테이블 생성하기
학생 정보를 저장할 `students` 테이블을 만듭니다.

- **`CREATE TABLE`**: 테이블을 생성하는 SQL 구문
- **`students`**: 테이블 이름
- **`(id INT..., name..., age...)`**: 테이블의 열(column)과 각 열의 데이터 타입을 정의

> 💡 테이블은 데이터베이스 내에서 실제 데이터가 행(row)과 열(column) 형태로 저장되는 구조입니다.
```

**6) 데이터 삽입**

```bash
INSERT INTO students (name, age) VALUES ('Alice', 20), ('Bob', 22);
```

```tech
mysql
```

```desc
#### ➕ 데이터 삽입하기
`students` 테이블에 두 명의 학생 데이터를 추가합니다.

- **`INSERT INTO`**: 테이블에 새로운 데이터를 추가하는 SQL 구문
- **`students (name, age)`**: 데이터를 추가할 테이블과 열을 지정
- **`VALUES ('Alice', 20), ...`**: 지정된 열에 맞춰 실제 데이터 값을 입력

> 💡 `id` 열은 `AUTO_INCREMENT`로 설정되어 있어 값을 직접 넣지 않아도 자동으로 1부터 증가하며 채워집니다.
```

**7) 데이터 조회**

```bash
SELECT * FROM students;
```

```tech
mysql
```

```desc
#### 🔍 데이터 조회하기
`students` 테이블에 있는 모든 데이터를 확인합니다.

- **`SELECT *`**: 모든 열의 데이터를 선택
- **`FROM students`**: `students` 테이블로부터 데이터를 가져옴

> 💡 `SELECT`는 데이터베이스에서 원하는 정보를 꺼내보는 가장 기본적인 SQL 명령어입니다.
```

**8) MariaDB 종료**

```bash
EXIT;
```

```tech
mysql
```

```desc
#### 🔌 MariaDB 접속 종료하기
MariaDB 클라이언트 세션을 종료하고 원래의 셸 환경으로 돌아갑니다.

- **`EXIT`** 또는 **`quit`**: 접속을 종료하는 명령어
- **`Ctrl + D`** 단축키로도 종료할 수 있습니다.

> 💡 데이터베이스 작업을 마친 후에는 접속을 종료하는 것이 좋습니다.
```

**9) 자동 설치된 의존성 패키지들 확인**

* 의존성 패키지: 패키지가 정상적으로 동작하기 위해 반드시 함께 설치되어야 하는 패키지

```bash
apt-mark showauto | grep -i mariadb
```

```tech
apt-mark, grep
```

```desc
#### 🔗 의존성 패키지 확인하기
`mariadb-server`를 설치할 때 함께 자동으로 설치된 패키지들을 확인합니다.

- **`apt-mark showauto`**: 자동으로 설치된 패키지 목록을 보여줌
- **`|` (파이프)**: 왼쪽 명령어의 결과를 오른쪽 명령어의 입력으로 전달
- **`grep -i mariadb`**: `mariadb`라는 단어가 포함된 줄을 대소문자 구분 없이 찾음

> 💡 특정 패키지를 삭제할 때, 함께 설치된 의존성 패키지들이 불필요하게 남는 경우가 있습니다.
```

**10) MariaDB 패키지 설정 파일까지 모두 삭제**

* purge는 명시한 mariadb-server 패키지와 설정 파일을 삭제합니다.

```bash
sudo apt purge -y mariadb-server
```

```tech
apt
```

```desc
#### 🗑️ 패키지와 설정 파일 함께 삭제하기
`mariadb-server` 패키지와 관련된 설정 파일까지 모두 삭제합니다.

- **`sudo apt purge`**: 패키지를 설정 파일까지 완전히 제거하는 명령어
- **`mariadb-server`**: 제거할 패키지 이름

> 💡 `remove`는 설정 파일을 남겨두지만, `purge`는 설정 파일까지 깨끗하게 지웁니다.
```

**11) 의존성 패키지 삭제**

* autoremove는 더 이상 사용되지 않는 자동 설치된 의존성 패키지를 정리합니다.

```bash
sudo apt autoremove -y
```

```tech
apt
```

```desc
#### 🧹 불필요한 의존성 패키지 정리하기
시스템에 더 이상 필요 없는 의존성 패키지들을 자동으로 찾아 삭제합니다.

- **`sudo apt autoremove`**: 다른 패키지에서 사용하지 않는 의존성 패키지를 제거

> 💡 패키지를 삭제한 뒤 이 명령어를 실행하면 시스템을 깔끔하게 유지할 수 있습니다.
```

**12) 패키지 캐시 정리**

* clean은 다운로드된 패키지 캐시를 정리합니다.

```bash
sudo apt clean
```

```tech
apt
```

```desc
#### 🧽 패키지 캐시 정리하기
패키지를 설치할 때 다운로드했던 `.deb` 파일들을 삭제하여 디스크 공간을 확보합니다.

- **`sudo apt clean`**: `/var/cache/apt/archives/` 디렉토리의 캐시 파일을 모두 삭제

> 💡 주기적으로 캐시를 정리해주면 불필요한 디스크 사용을 줄일 수 있습니다.
```

**13) 패키지 삭제 여부 확인**

* list --installed는 설치된 실행 가능한 패키지들을 확인 가능합니다.

```bash
apt list --installed | grep -i mariadb
```

```tech
apt, grep
```

```desc
#### ✅ 패키지 삭제 여부 확인 (apt)
`apt` 명령어를 사용하여 `mariadb` 관련 패키지가 설치된 목록에 더 이상 없는지 확인합니다.

- **`apt list --installed`**: 현재 설치된 모든 패키지 목록을 보여줌
- **`grep -i mariadb`**: `mariadb`가 포함된 줄을 검색

> 💡 이 명령어 실행 후 아무것도 출력되지 않으면 패키지가 성공적으로 제거된 것입니다.
```

**14) 설정 파일까지 모두 삭제되었는지 확인**

* dpkg -l은 설정 파일 존재 여부까지 확인 가능합니다.
* 의존성 패키지들이 rc 형태로 남아있는 것을 확인할 수 있습니다. 
* rc: 패키지는 삭제되었으나, 설정 파일이 남아 있음

```bash
dpkg -l | grep -i mariadb
```

```tech
dpkg, grep
```

```desc
#### 📜 설정 파일 잔여 여부 확인 (dpkg)
`dpkg`를 이용해 `mariadb` 관련 패키지의 상태를 확인하여 설정 파일이 남아있는지 검사합니다.

- **`dpkg -l`**: 설치된 모든 패키지의 상세 정보를 보여줌
- **`grep -i mariadb`**: `mariadb` 관련 패키지 검색
- **`rc` 상태**: 패키지는 삭제(removed)되었지만 설정 파일(config-files)은 남아있음을 의미

> 💡 `apt purge`로도 지워지지 않은 의존성 패키지의 설정 파일들이 남아있을 수 있습니다.
```

**15) rc 상태인 패키지 목록을 변수에 저장**

* 설정 파일만 남아 있는 패키지 이름을 추출해서 config_pkgs 변수에 저장합니다.

```bash
config_pkgs=$(dpkg -l | grep -i mariadb | awk '{print $2}')
```

```tech
dpkg, grep, awk
```

```desc
#### 📝 잔여 설정 파일 목록 저장하기
설정 파일만 남은(`rc` 상태) 패키지들의 이름을 찾아 변수에 저장합니다.

- **`dpkg -l | grep ...`**: `rc` 상태의 `mariadb` 패키지 목록을 찾음
- **`awk '{print $2}'`**: 출력된 내용에서 두 번째 열(패키지 이름)만 추출
- **`config_pkgs=$(...)`**: 명령어의 실행 결과를 `config_pkgs`라는 변수에 저장

> 💡 `awk`는 텍스트를 처리하는 강력한 도구로, 특정 열의 데이터만 뽑아낼 때 유용합니다.
```

**16) 저장된 패키지 이름 확인**

```bash
echo $config_pkgs
```

```tech
echo
```

```desc
#### 👀 저장된 변수 내용 확인하기
앞서 저장한 `config_pkgs` 변수에 패키지 이름들이 잘 들어있는지 확인합니다.

- **`echo`**: 뒤에 오는 문자열이나 변수의 값을 출력
- **`$config_pkgs`**: `config_pkgs` 변수의 값을 의미

> 💡 변수 이름 앞에 `를 붙여야 변수에 저장된 값을 사용할 수 있습니다.
```

**17) 삭제 방법 1: 남아 있는 의존성 패키지들의 설정 파일 제거**

* purge에 패키지명을 명시해주면, 해당 패키지들의 설정 파일까지 제거합니다.
* 삭제 도중 /var/lib/mysql, 즉 데이터 디렉터리까지 모두 삭제할 것인지 묻는 창이 나타납니다. 데이터까지 모두 삭제하려면 YES, 그렇지 않다면 NO를 눌러 진행합니다.

```bash
sudo apt purge -y $config_pkgs
```

```tech
apt
```

```desc
#### 🗑️ 잔여 설정 파일 모두 삭제하기
변수에 저장된 패키지 목록을 `apt purge`에 넘겨주어 남아있던 설정 파일들을 모두 삭제합니다.

- **`sudo apt purge -y`**: 설정 파일까지 완전히 삭제
- **`$config_pkgs`**: 앞서 저장해둔, 삭제할 패키지 이름 목록

> 💡 셸 스크립트에서 변수를 활용하면 이렇게 여러 패키지를 한 번에 처리할 수 있어 편리합니다.
```

**18) 모두 삭제되었는지 최종 확인**

```bash
dpkg -l | grep -i mariadb
```

```tech
dpkg, grep
```

```desc
#### ✅ 최종 삭제 확인
`dpkg` 명령어를 다시 실행하여 `mariadb`와 관련된 모든 패키지 및 설정 파일이 완전히 사라졌는지 확인합니다.

- **`dpkg -l | grep -i mariadb`**
- 이제 이 명령어를 실행했을 때 아무것도 출력되지 않아야 합니다.

> 💡 이 단계에서 출력이 없다면, 시스템에서 MariaDB 관련 요소들이 깨끗하게 정리된 것입니다.
```

**19) MariaDB 재설치**

```bash
sudo apt install -y mariadb-server
```

```tech
apt
```

```desc
#### 🔄 MariaDB 재설치하기
필요하다면 `mariadb-server`를 다시 설치합니다.

- **`sudo apt install -y mariadb-server`**
- 완전히 삭제된 상태이므로 처음 설치할 때와 동일하게 새로운 환경으로 설치됩니다.

> 💡 패키지 설정 문제로 재설치할 때는, 이처럼 `purge`로 완전히 지우고 다시 설치하는 것이 가장 확실한 방법입니다.
```

**20) 삭제 방법 2: 패키지와 의존성 패키지 설정파일까지 한번에 삭제**

* purge와 autoremove를 같이 사용하면 명시한 패키지와 의존성 패키지들의 모든 관련 요소를 삭제할 수 있습니다.
* 역시 삭제 도중 /var/lib/mysql, 즉 데이터 디렉터리까지 모두 삭제할 것인지 묻는 창이 나타납니다. 데이터까지 모두 삭제하려면 YES, 그렇지 않다면 NO를 눌러 진행합니다.

```bash
sudo apt purge --auto-remove -y mariadb-server
```

```tech
apt
```

```desc
#### 💥 한 번에 모두 삭제하기 (권장)
`purge`와 `--auto-remove` 옵션을 함께 사용하여 패키지, 설정 파일, 불필요한 의존성 패키지까지 한 번에 모두 삭제합니다.

- **`sudo apt purge --auto-remove -y`**: 지정한 패키지와 그에 딸린 모든 것을 제거
- **`mariadb-server`**: 삭제할 메인 패키지

> 💡 이 방법이 여러 단계를 거치지 않고 가장 깔끔하게 패키지를 제거하는 효율적인 방법입니다.
```

**21) 모두 삭제되었는지 재확인**

```bash
dpkg -l | grep -i mariadb
```

```tech
dpkg, grep
```

```desc
#### ✅ 재확인
`dpkg` 명령어로 `mariadb` 관련 패키지가 시스템에 남아있지 않은지 최종적으로 확인합니다.

- **`dpkg -l | grep -i mariadb`**
- 이 명령어를 실행했을 때 아무런 출력이 없으면 성공적으로 삭제된 것입니다.

> 💡 패키지를 관리할 때 `apt`와 `dpkg`의 특징을 잘 이해하고 함께 사용하면 좋습니다.
```
