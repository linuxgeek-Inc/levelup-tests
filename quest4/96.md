##### K8s: kubectl topμΌλ΅ CPU/λ©”λ¨λ¦¬ μ‚¬μ©λ‰ ν™•μΈ #####

**1) λ…Έλ“(Node)μ λ¦¬μ†μ¤ μ‚¬μ©λ‰ ν™•μΈ**

**- μ°Έκ³ :** `metrics-server` λ΅λ”© λ€κΈ°μ‹κ°„μ„ μ„ν•΄ 30μ΄ sleep μ‹¤ν–‰

```bash
sleep 30 && kubectl top node
```
```tech
bash,kubectl,kubernetes
```
```desc
#### π–¥οΈ λ…Έλ“ λ¦¬μ†μ¤ μ‚¬μ©λ‰ ν™•μΈν•κΈ°
ν΄λ¬μ¤ν„° λ‚΄ λ¨λ“  λ…Έλ“(μ„λ²„)μ ν„μ¬ CPU λ° λ©”λ¨λ¦¬ μ‚¬μ©λ‰μ„ ν™•μΈν•©λ‹λ‹¤.

**- μ°Έκ³ :** `metrics-server` λ΅λ”© λ€κΈ°μ‹κ°„μ„ μ„ν•΄ 30μ΄ sleep μ‹¤ν–‰

- **`kubectl top node`**: κ° λ…Έλ“μ λ¦¬μ†μ¤ μ‚¬μ©λ‰μ„ λ³΄μ—¬μ£Όλ” λ…λ Ήμ–΄
- **`watch`**: λ…λ Ήμ–΄λ¥Ό μ£ΌκΈ°μ μΌλ΅ λ°λ³µ μ‹¤ν–‰ν•μ—¬ κ²°κ³Όλ¥Ό λ™μ μΌλ΅ λ³΄μ—¬μ¤
- **`timeout 30`**: 30μ΄ ν›„μ— `watch` λ…λ Ήμ–΄λ¥Ό μλ™μΌλ΅ μΆ…λ£

> π’΅ ν΄λ¬μ¤ν„° μ „μ²΄μ λ¶€ν• μƒνƒλ¥Ό ν•λμ— νμ•…ν•  λ• μ μ©ν•©λ‹λ‹¤.
```

**2) ν…μ¤νΈμ© νλ“ μƒμ„±**
```bash
kubectl create deployment top-test --image=nginx --replicas=2
```
```tech
bash,kubectl,kubernetes
```
```desc
#### π€ ν…μ¤νΈμ© νλ“ μƒμ„±ν•κΈ°
λ¦¬μ†μ¤ μ‚¬μ©λ‰μ„ ν™•μΈν•  ν…μ¤νΈμ© Nginx νλ“λ¥Ό 2κ° μƒμ„±ν•©λ‹λ‹¤.

- **`kubectl create deployment`**: μƒλ΅μ΄ λ””ν”λ΅μ΄λ¨ΌνΈλ¥Ό μƒμ„±
- **`top-test`**: λ””ν”λ΅μ΄λ¨ΌνΈμ μ΄λ¦„
- **`--image=nginx`**: μ‚¬μ©ν•  μ»¨ν…μ΄λ„ μ΄λ―Έμ§€
- **`--replicas=2`**: μƒμ„±ν•  νλ“μ κ°μ

> π’΅ `Deployment`λ” νλ“λ¥Ό κ΄€λ¦¬ν•κ³  μ•μ •μ μΌλ΅ μ μ§€ν•λ” μ—­ν• μ„ ν•©λ‹λ‹¤.
```

**3) Deploymentκ°€ μ¤€λΉ„ λ  λ•κΉμ§€ wait**
```bash
kubectl wait --for=condition=available deployment/top-test --timeout=60s
```
```tech
kubectl
```
```desc
#### β³ νλ“ μ¤€λΉ„ μƒνƒ λ€κΈ°ν•κΈ°
μƒμ„±ν• λ””ν”λ΅μ΄λ¨ΌνΈμ νλ“λ“¤μ΄ 'Available'(μ‚¬μ© κ°€λ¥) μƒνƒκ°€ λ  λ•κΉμ§€ κΈ°λ‹¤λ¦½λ‹λ‹¤.

- **`kubectl wait`**: νΉμ • μ΅°κ±΄μ΄ μ¶©μ΅±λ  λ•κΉμ§€ λ€κΈ°
- **`--for=condition=available`**: 'Available' μƒνƒλ¥Ό κΈ°λ‹¤λ¦Ό
- **`deployment/top-test`**: λ€μƒ λ””ν”λ΅μ΄λ¨ΌνΈ
- **`--timeout=60s`**: μµλ€ 60μ΄κΉμ§€ κΈ°λ‹¤λ¦¬κ³ , μ΄κ³Ό μ‹ μ¤λ¥ λ°μƒ

> π’΅ μ¤ν¬λ¦½νΈμ—μ„ νλ“κ°€ μ™„μ „ν μ‹¤ν–‰λ ν›„ λ‹¤μ λ…λ Ήμ„ μ‹¤ν–‰ν•΄μ•Ό ν•  λ• μ μ©ν•©λ‹λ‹¤.
```

**4) νλ“(Pod)μ λ¦¬μ†μ¤ μ‚¬μ©λ‰ ν™•μΈ**

**- μ°Έκ³ :** `metrics-server` λ΅λ”© λ€κΈ°μ‹κ°„μ„ μ„ν•΄ 30μ΄ sleep μ‹¤ν–‰

```bash
sleep 30 && kubectl top pod
```
```tech
bash,kubectl,kubernetes
```
```desc
#### π“ νλ“ λ¦¬μ†μ¤ μ‚¬μ©λ‰ ν™•μΈν•κΈ°
ν„μ¬ λ„¤μ„μ¤νμ΄μ¤μ— μλ” λ¨λ“  νλ“μ CPU λ° λ©”λ¨λ¦¬ μ‚¬μ©λ‰μ„ ν™•μΈν•©λ‹λ‹¤.

- **`kubectl top pod`**: νλ“μ λ¦¬μ†μ¤ μ‚¬μ©λ‰μ„ λ³΄μ—¬μ£Όλ” λ…λ Ήμ–΄
- **`watch`**: κ²°κ³Όλ¥Ό μ£ΌκΈ°μ μΌλ΅ κ°±μ‹ ν•μ—¬ λ™μ μΌλ΅ λ³΄μ—¬μ¤
- **`timeout 10`**: 10μ΄ ν›„ `watch` λ…λ Ήμ–΄ μλ™ μΆ…λ£

> π’΅ μ–΄λ–¤ νλ“κ°€ λ¦¬μ†μ¤λ¥Ό λ§μ΄ μ‚¬μ©ν•λ”μ§€ μ‹¤μ‹κ°„μΌλ΅ λ¨λ‹ν„°λ§ν•  μ μμµλ‹λ‹¤.
```

**5) νΉμ • λ„¤μ„μ¤νμ΄μ¤μ νλ“ λ¦¬μ†μ¤ μ‚¬μ©λ‰ ν™•μΈ**
```bash
kubectl top pod -n kube-system
```
```tech
bash,kubectl,kubernetes
```
```desc
#### π― νΉμ • λ„¤μ„μ¤νμ΄μ¤ νλ“ ν™•μΈν•κΈ°
`-n` μµμ…μ„ μ‚¬μ©ν•μ—¬ μ§€μ •λ λ„¤μ„μ¤νμ΄μ¤μ νλ“ λ¦¬μ†μ¤ μ‚¬μ©λ‰λ§ ν™•μΈν•©λ‹λ‹¤.

- **`kubectl top pod`**: νλ“ λ¦¬μ†μ¤ μ‚¬μ©λ‰ ν™•μΈ
- **`-n kube-system`**: `kube-system` λ„¤μ„μ¤νμ΄μ¤λ¥Ό μ§€μ •

> π’΅ μΏ λ²„λ„¤ν‹°μ¤ μ‹μ¤ν… μμ²΄μ κµ¬μ„±μ”μ†λ“¤μ΄ μ‚¬μ©ν•λ” λ¦¬μ†μ¤λ¥Ό ν™•μΈν•  λ• μ μ©ν•©λ‹λ‹¤.
```

**6) λ¨λ“  λ„¤μ„μ¤νμ΄μ¤μ νλ“ λ¦¬μ†μ¤ μ‚¬μ©λ‰ ν™•μΈ**
```bash
kubectl top pod --all-namespaces
```
```tech
bash,kubectl,kubernetes
```
```desc
#### π λ¨λ“  λ„¤μ„μ¤νμ΄μ¤ νλ“ ν™•μΈν•κΈ°
`--all-namespaces` μµμ…μ„ μ‚¬μ©ν•μ—¬ ν΄λ¬μ¤ν„° λ‚΄ λ¨λ“  λ„¤μ„μ¤νμ΄μ¤μ νλ“ λ¦¬μ†μ¤ μ‚¬μ©λ‰μ„ ν™•μΈν•©λ‹λ‹¤.

- **`kubectl top pod`**: νλ“ λ¦¬μ†μ¤ μ‚¬μ©λ‰ ν™•μΈ
- **`--all-namespaces`**: λ¨λ“  λ„¤μ„μ¤νμ΄μ¤λ¥Ό λ€μƒμΌλ΅ μ§€μ •

> π’΅ ν΄λ¬μ¤ν„° μ „μ²΄μ—μ„ μ–΄λ–¤ νλ“κ°€ λ¦¬μ†μ¤λ¥Ό λ§μ΄ μ‚¬μ©ν•λ”μ§€ ν• λ²μ— νμ•…ν•  μ μμµλ‹λ‹¤.
```

**7) μ‹¤μµ μμ› μ •λ¦¬**
```bash
kubectl delete deployment top-test
```
```tech
bash,kubectl,kubernetes
```
```desc
#### π§Ή μ‹¤μµ μμ› μ •λ¦¬ν•κΈ°
μ‹¤μµμ„ μ„ν•΄ μƒμ„±ν–λ λ””ν”λ΅μ΄λ¨ΌνΈλ¥Ό μ‚­μ ν•©λ‹λ‹¤.

- **`kubectl delete deployment`**: λ””ν”λ΅μ΄λ¨ΌνΈλ¥Ό μ‚­μ ν•λ” λ…λ Ήμ–΄
- **`top-test`**: μ‚­μ ν•  λ””ν”λ΅μ΄λ¨ΌνΈμ μ΄λ¦„

> π’΅ λ””ν”λ΅μ΄λ¨ΌνΈλ¥Ό μ‚­μ ν•λ©΄ κ΄€λ ¨λ νλ“(Pod)μ™€ λ ν”λ¦¬μΉ΄μ…‹(ReplicaSet)λ„ ν•¨κ» μ •λ¦¬λ©λ‹λ‹¤.
```
