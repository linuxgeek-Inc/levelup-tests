##### 도커 네트워크 docker0 기본구조 확인하려면 ? #####

**1) 도커 네트워크 목록 확인**

```bash
docker network ls
```

```tech
docker,network,ls,bash
```

```desc
#### 🌐 도커 네트워크 목록 조회
`docker network ls` 명령어는 현재 도커 호스트에 존재하는 모든 네트워크의 목록을 보여줍니다.

- **기본 네트워크**: `bridge`, `host`, `none`과 같은 기본 네트워크들이 표시됩니다.
- **bridge**: 컨테이너를 생성할 때 별도의 네트워크 설정을 하지 않으면 기본적으로 연결되는 가상 네트워크입니다.

> 💡 컨테이너들이 어떤 네트워크 환경에서 동작하는지 전체적인 그림을 파악할 때 사용하는 기본 명령어입니다.
```

**2) 'bridge' 네트워크 상세 정보 확인**

* 참고: 컨테이너 실행전 `docker0` 네트워크 정보만 확인가능하다.

```bash
docker network inspect bridge
```

```tech
docker,network,inspect,bridge,bash
```

```desc
#### 🔍 'bridge' 네트워크 상세 정보
`docker network inspect bridge` 명령어는 `bridge` 네트워크의 상세한 설정 정보를 JSON 형식으로 보여줍니다.

- **주요정보**: 서브넷(Subnet), 게이트웨이(Gateway) IP 주소 등을 확인할 수 있습니다.
- **"Containers" 섹션**: 현재 이 네트워크에 연결된 컨테이너 목록을 보여줍니다. 지금은 아무것도 없는 것이 정상입니다.

> 💡 특정 네트워크의 IP 대역이나 게이트웨이 정보를 확인하거나, 어떤 컨테이너들이 연결되어 있는지 파악할 때 사용합니다.
```

**3) 호스트의 'docker0' 인터페이스 확인**

```bash
ip addr show | grep -A 20 docker0
```
```no-err-check
```
```tech
ip,addr,show,grep,bash,rocky
```

```desc
#### 🖥️ 호스트의 가상 브릿지 확인
`ip addr show | grep -A 20 docker0` 명령어는 도커가 호스트 머신에 생성한 `docker0`라는 가상 네트워크 인터페이스의 정보를 보여줍니다.

- **docker0**: `bridge` 네트워크와 연결된 가상 브릿지로, 컨테이너들의 게이트웨이 역할을 합니다.
- **IP 주소**: `docker network inspect bridge`에서 본 게이트웨이 IP 주소와 동일한 주소가 할당된 것을 볼 수 있습니다.

> 💡 컨테이너가 외부와 통신할 때 거쳐가는 관문(Gateway)의 실체를 호스트 관점에서 확인할 수 있습니다.
```

**4) 테스트용 우분투 컨테이너 실행**

```bash
docker run -it -d --name ubuntu_container ubuntu:20.04
```

```tech
docker,run,ubuntu,bash
```

```desc
#### 🚀 테스트 컨테이너 실행
`docker run ...` 명령어로 `ubuntu:20.04` 이미지를 사용하여 `ubuntu_container`라는 이름의 컨테이너를 백그라운드(`-d`)에서 실행합니다.

- **네트워크 연결**: 별도로 네트워크를 지정하지 않았으므로, 이 컨테이너는 자동으로 기본 `bridge` 네트워크에 연결됩니다.

> 💡 네트워크에 연결되는 컨테이너가 생겼을 때의 변화를 관찰하기 위한 준비 단계입니다.
```

**5) 컨테이너의 IP 주소만 간단히 확인**

```bash
docker inspect -f '{{range.NetworkSettings.Networks}}{{.IPAddress}}{{end}}' ubuntu_container
```

```tech
docker,inspect,bash
```

```desc
#### 📝 컨테이너 IP 주소 추출
`docker inspect` 명령어에 Go 템플릿 형식(`-f '...'`)을 사용하여 실행 중인 `ubuntu_container`의 IP 주소만 정확히 추출합니다.

- **IP 할당**: `bridge` 네트워크의 서브넷 대역 내에서 IP 주소가 할당된 것을 볼 수 있습니다.

> 💡 스크립트 등에서 컨테이너의 IP 정보만 필요할 때 유용하게 사용할 수 있는 방법입니다.
```

**6) 컨테이너의 네트워크 설정 상세 확인**

```bash
docker inspect ubuntu_container | grep -A 9 "Networks"
```

```tech
docker,inspect,grep,bash
```

```desc
#### 📋 컨테이너 네트워크 상세 정보
`docker inspect`와 `grep`을 함께 사용하여 `ubuntu_container`의 상세 정보 중 "Networks" 섹션만 필터링하여 봅니다.

- **상세 정보**: 컨테이너에 할당된 IP 주소, 게이트웨이 주소, MAC 주소 등 모든 네트워크 관련 정보를 확인할 수 있습니다.
- **게이트웨이**: `docker0` 브릿지의 IP 주소가 게이트웨이로 설정된 것을 볼 수 있습니다.

> 💡 컨테이너 관점에서 자신의 네트워크 설정이 어떻게 구성되어 있는지 확인할 수 있습니다.
```

**7) 'bridge' 네트워크 상세 정보 확인 (컨테이너 실행 후)**

```bash
docker network inspect bridge
```

```tech
docker,network,inspect,bridge,bash
```

```desc
#### 🔄 'bridge' 네트워크 변화 확인
다시 `docker network inspect bridge` 명령어를 실행하면, 이전과 달리 "Containers" 섹션에 방금 실행한 `ubuntu_container`가 목록에 추가된 것을 확인할 수 있습니다.

- **컨테이너 연결 확인**: 컨테이너의 이름, MAC 주소, IP 주소 등이 표시되어 `bridge` 네트워크에 성공적으로 연결되었음을 증명합니다.

> 💡 도커 네트워크에 컨테이너가 연결되고 해제될 때마다 이 정보가 동적으로 업데이트됩니다.
```

**8) 호스트의 'docker0' 인터페이스 재확인**

```bash
ip addr show | grep -A 20 docker0
```
```no-err-check
```

```tech
ip,addr,show,grep,bash,rocky
```

```desc
#### 🌉 'docker0' 인터페이스 상태
`ip addr show | grep -A 20 docker0` 명령어를 다시 실행해 봅니다. `docker0` 인터페이스의 IP 주소 등 기본 정보는 변하지 않습니다.

- **역할 수행**: 이 인터페이스는 이제 `ubuntu_container`의 게이트웨이로서 실제로 트래픽을 처리할 준비를 마친 상태입니다.

> 💡 컨테이너가 추가되어도 게이트웨이 자체의 주소는 바뀌지 않으며, 이 게이트웨이를 통해 여러 컨테이너가 외부와 통신하게 됩니다.
```

**9) EPEL 저장소 설치**

```bash
sudo dnf install -y epel-release
```

```tech
sudo,dnf,install,epel-release,bash,rocky
```

```desc
#### 📦 EPEL 저장소 설치
`bridge-utils` 패키지를 설치하기 위해 먼저 EPEL(Extra Packages for Enterprise Linux) 저장소를 설치합니다. `brctl`과 같은 유용한 유틸리티들이 이 저장소에 포함되어 있는 경우가 많습니다.

- **EPEL**: Enterprise Linux용 추가 패키지 저장소입니다.

> 💡 Rocky Linux에서 기본 저장소에 없는 패키지를 설치할 때 자주 필요합니다.
```

**10) 브릿지 관리 도구 설치**

```bash
sudo dnf install -y bridge-utils
```

```tech
sudo,dnf,install,bridge-utils,bash,rocky
```

```desc
#### 🛠️ 브릿지 관리 도구 설치
`brctl` 명령어를 사용하기 위해 `bridge-utils` 패키지를 설치합니다. 이 도구는 리눅스 커널의 네트워크 브릿지를 관리하고 확인하는 데 사용됩니다.

- **brctl**: `docker0`와 같은 네트워크 브릿지의 상태를 상세히 볼 수 있게 해줍니다.

> 💡 `ip addr`보다 더 브릿지에 특화된 정보를 보고 싶을 때 사용하는 전문 도구입니다.
```

**11) docker0 브릿지 정보 확인**

```bash
brctl show
```

```tech
brctl,show,bash,rocky
```

```desc
#### 📊 브릿지 정보 확인
`brctl show` 명령어로 현재 시스템의 네트워크 브릿지 정보를 확인합니다. `docker0` 브릿지와 여기에 연결된 가상 인터페이스(`veth*`)를 볼 수 있습니다.

- **interfaces**: 현재는 `ubuntu_container`에 연결된 가상 인터페이스 하나만 `docker0`에 연결되어 표시됩니다.

> 💡 어떤 가상 인터페이스가 브릿지에 연결되어 있는지 명확하게 보여줍니다.
```

**12) 추가 컨테이너 실행 1**

```bash
docker run -it -d ubuntu:20.04
```

```tech
docker,run,ubuntu,bash
```

```desc
#### ➕ 추가 컨테이너 실행 1
테스트를 위해 새로운 우분투 컨테이너를 추가로 실행합니다. 이 컨테이너도 기본적으로 `bridge` 네트워크에 연결됩니다.

- **자동 연결**: `docker0` 브릿지에 새로운 가상 인터페이스가 자동으로 생성되고 연결됩니다.

> 💡 컨테이너가 늘어날 때마다 네트워크 구조가 어떻게 변하는지 관찰해봅니다.
```

**13) 추가 컨테이너 실행 2**

```bash
docker run -it -d ubuntu:20.04
```

```tech
docker,run,ubuntu,bash
```

```desc
#### ➕➕ 추가 컨테이너 실행 2
세 번째 우분투 컨테이너를 실행하여 `docker0` 브릿지에 또 하나의 가상 인터페이스가 추가되도록 합니다.

- **확장성**: `docker0` 브릿지는 여러 컨테이너의 네트워크 트래픽을 동시에 처리할 수 있습니다.

> 💡 여러 컨테이너가 동일한 `bridge` 네트워크를 공유하는 일반적인 사용 사례를 보여줍니다.
```

**14) docker0 브릿지 정보 다시 확인**

```bash
brctl show
```

```tech
brctl,show,bash,rocky
```

```desc
#### 🔄 브릿지 정보 변화 최종 확인
`brctl show` 명령어를 다시 실행하면, 새로 생성된 두 개의 컨테이너에 해당하는 가상 인터페이스(`veth*`)가 `docker0` 브릿지에 추가로 연결된 것을 확인할 수 있습니다.

- **총 3개 인터페이스**: `docker0`에 총 3개의 가상 인터페이스가 연결된 것을 보여줍니다.

> 💡 이를 통해 여러 컨테이너가 하나의 브릿지를 통해 외부와 통신하는 구조를 명확히 파악할 수 있습니다.
```

**15) 실습 종료**

```bash
: quit
```

```tech
bash,rocky
```

```desc
#### 👋 실습 종료
실습을 종료를 의미하는 `quit` 명령어를 실행합니다.
현재 터미널 세션을 종료합니다.

> 💡 모든 실습을 마친 후 사용합니다.
```
