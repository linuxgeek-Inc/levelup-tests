##### K8s: YAML 파일을 이용한 Deployment 배포 및 수정 #####

**1) Deployment 원본 YAML 파일 생성**
```bash
kubectl create deployment nginx-yaml-deployment --image=nginx --dry-run=client -o yaml > nginx-original.yaml
```
```tech
bash,kubectl,kubernetes,yaml
```
```desc
#### 📄 Deployment YAML 파일 초안 생성
실제로 리소스를 생성하지 않고, Deployment를 만들기 위한 YAML 파일의 내용을 생성합니다.

- **`--dry-run=client`**: 클라이언트 측에서만 실행하여 서버에 요청을 보내지 않습니다. 리소스를 생성하는 대신 YAML 정의를 만듭니다.
- **`-o yaml`**: 출력 형식을 YAML로 지정합니다.
- **`>`**: 결과를 `nginx-original.yaml` 파일에 저장합니다.

> 💡 이 방법은 처음부터 YAML을 작성하는 대신, 기본 템플릿을 빠르게 만드는 데 매우 유용합니다.
```

**2) 원본 YAML 파일 내용 확인**
```bash
cat nginx-original.yaml
```
```tech
bash,cat
```
```desc
#### 👀 원본 YAML 파일 내용 확인
생성된 Deployment YAML 파일의 내용을 확인합니다.

- **`cat`**: 파일의 내용을 터미널에 출력합니다.

> 💡 파일에는 `apiVersion`, `kind`, `metadata`, `spec` 등 쿠버네티스 리소스의 모든 필수 필드가 포함되어 있습니다.
```

**3) `sed`를 이용해 복제본 개수 수정**
```bash
sed 's/replicas: 1/replicas: 3/' nginx-original.yaml > nginx-modified.yaml
```
```tech
bash,sed
```
```desc
#### ✍️ `sed`로 복제본 개수 수정
`sed` 스트림 편집기를 사용하여 복제본(replicas) 수를 1에서 3으로 변경하고 새 파일로 저장합니다.

- **`sed 's/old/new/'`**: `old` 문자열을 `new` 문자열로 치환합니다.
- **`nginx-original.yaml`**: 입력 파일입니다.
- **`> nginx-modified.yaml`**: 변경된 내용을 새로운 파일에 저장합니다.

> 💡 YAML 파일을 직접 열어 수정할 수도 있지만, `sed`를 사용하면 스크립트를 통해 자동화하기 편리합니다.
```

**4) 수정된 YAML 파일 내용 확인**
```bash
cat nginx-modified.yaml
```
```tech
bash,cat
```
```desc
#### 👀 수정된 YAML 파일 내용 확인
복제본 개수가 변경된 새로운 YAML 파일의 내용을 확인합니다.

- **`cat`**: 파일 내용을 출력합니다.
- `replicas: 3`으로 변경되었는지 확인합니다.

> 💡 배포하기 전에 항상 변경 사항을 다시 한번 확인하는 것이 좋습니다.
```

**5) colordiff 설치**
```bash
sudo apt install -y colordiff
```
```tech
apt
```
```desc
#### 🎨 `colordiff` 설치
두 파일의 차이점을 색상으로 구분하여 보여주는 `colordiff` 유틸리티를 설치합니다.

- **`sudo apt install -y`**: `apt` 패키지 매니저를 사용하여 `-y` 옵션으로 자동 설치합니다.
- `diff` 명령어보다 가독성이 좋습니다.

> 💡 데비안/우분투 계열에서는 `apt`, CentOS/RHEL 계열에서는 `dnf`나 `yum`을 사용합니다.
```

**6) 원본과 수정본의 차이점 확인 (diff)**
```bash
colordiff -uNrFp nginx-original.yaml nginx-modified.yaml
```
```tech
bash,diff
```
```desc
#### 🔄 원본과 수정본 차이 비교
두 YAML 파일 간의 차이점을 시각적으로 확인합니다.

- **`colordiff`**: 색상으로 파일 차이를 보여줍니다.
- **`-u`**: Unified 형식으로 차이점을 보여주어 가독성을 높입니다.
- `replicas` 필드가 어떻게 변경되었는지 명확하게 볼 수 있습니다.

> 💡 Git과 같은 버전 관리 시스템을 사용하면 이러한 변경 사항을 더욱 체계적으로 관리할 수 있습니다.
```

**7) 수정된 YAML 파일을 사용하여 Deployment 배포**
```bash
kubectl apply -f nginx-modified.yaml
```
```tech
bash,kubectl,kubernetes,yaml
```
```desc
#### 🚀 수정된 YAML 파일로 Deployment 배포
수정된 YAML 파일의 내용대로 쿠버네티스 클러스터에 리소스를 생성하거나 업데이트합니다.

- **`kubectl apply`**: 선언적 방식(YAML에 정의된 상태)으로 리소스를 관리합니다.
- **`-f`**: 파일로부터 리소스 정의를 읽어옵니다.

> 💡 `kubectl create`는 명령형 방식, `kubectl apply`는 선언형 방식으로, 보통 `apply`가 더 권장됩니다.
```

**8) Deployment가 준비 될 때까지 wait**
```bash
kubectl wait --for=condition=available deployment/nginx-yaml-deployment --timeout=60s
```
```tech
kubectl
```
```desc
#### ⏳ Deployment 준비 대기
YAML 파일로 배포한 Deployment가 완전히 준비될 때까지 기다립니다.

- **`kubectl wait`**: 특정 조건이 충족될 때까지 대기합니다.
- **`--for=condition=available`**: 모든 복제본이 준비 상태가 될 때까지 기다립니다.

> 💡 배포가 성공적으로 완료되었는지 확인하는 과정입니다.
```

**9) 배포 결과 확인 (Deployment)**
```bash
kubectl get deployment nginx-yaml-deployment
```
```tech
bash,kubectl,kubernetes
```
```desc
#### ✅ 배포 결과 확인 (Deployment)
배포된 Deployment의 상태를 확인합니다.

- **`kubectl get deployment`**: Deployment의 요약 정보를 보여줍니다.
- `READY` 컬럼이 `3/3`으로 표시되어, 3개의 복제본이 모두 준비되었음을 확인합니다.

> 💡 `replicas: 3` 설정이 잘 적용되었음을 알 수 있습니다.
```

**10) 배포 결과 확인 (Pods)**
```bash
kubectl get pods -l app=nginx-yaml-deployment
```
```tech
bash,kubectl,kubernetes
```
```desc
#### ✅ 배포 결과 확인 (Pods)
해당 Deployment에 의해 생성된 Pod 목록을 확인합니다.

- **`kubectl get pods`**: Pod 목록을 조회합니다.
- **`-l app=nginx-yaml-deployment`**: `app` 레이블로 Pod를 필터링합니다.

> 💡 3개의 Pod가 모두 `Running` 상태인지 확인할 수 있습니다.
```

**11) 실습 종료**

```bash
: quit
```

```tech
bash,rocky
```

```desc
#### 👋 실습 종료
실습을 종료를 의미하는 `quit` 명령어를 실행합니다.
현재 터미널 세션을 종료합니다.

> 💡 모든 실습을 마친 후 사용합니다.
```