##### Swarm: μ„λΉ„μ¤ νΉμ • ν¬νΈ μ™Έλ¶€ μ ‘μ† ν™•μΈ #####

> **μ°Έκ³ :** μ΄ μ‹¤μµμ—μ„λ” κ΄€λ¦¬μ λ…Έλ“ IPλ΅ `192.168.0.2`, μ‘μ—…μ λ…Έλ“ IPλ΅ `192.168.0.3`μ„ μ‚¬μ©ν•©λ‹λ‹¤. μ‹¤μ  ν™κ²½μ— λ§κ² IP μ£Όμ†λ¥Ό λ³€κ²½ν•μ—¬ μ‹¤ν–‰ν•μ„Έμ”.

**1) Manager Node: ν¬νΈ ν™•μΈμ© μ„λΉ„μ¤ μƒμ„±**
μ™Έλ¶€ μ ‘μ†μ„ ν™•μΈν•  `nginx-port-check` μ„λΉ„μ¤λ¥Ό μƒμ„±ν•κ³ , νΈμ¤νΈμ 9999λ² ν¬νΈλ¥Ό μ»¨ν…μ΄λ„μ 80λ² ν¬νΈλ΅ λ§¤ν•‘ν•©λ‹λ‹¤.

```bash
docker service create --name nginx-port-check --publish published=9999,target=80 nginx
```

```tech
docker, swarm, nginx
```

```desc
#### π€ νΉμ • ν¬νΈλ΅ μ„λΉ„μ¤ μƒμ„±
μ™Έλ¶€μ—μ„ νΉμ • ν¬νΈλ΅ μ ‘μ†ν•λ” κ²ƒμ„ ν…μ¤νΈν•κΈ° μ„ν•΄ Nginx μ„λΉ„μ¤λ¥Ό μƒμ„±ν•κ³  ν¬νΈλ¥Ό μ§€μ •ν•©λ‹λ‹¤.

- **`--publish published=9999,target=80`**: ν΄λ¬μ¤ν„°μ λ¨λ“  λ…Έλ“μ—μ„ 9999λ² ν¬νΈλ΅ λ“¤μ–΄μ¤λ” μ”μ²­μ„ μ΄ μ„λΉ„μ¤μ μ»¨ν…μ΄λ„ 80λ² ν¬νΈλ΅ μ „λ‹¬
- **`published=9999`**: μ™Έλ¶€μ— λ…Έμ¶λ  ν¬νΈ
- **`target=80`**: μ»¨ν…μ΄λ„ λ‚΄λ¶€μ ν¬νΈ

> π’΅ `published` ν¬νΈλ” ν΄λ¬μ¤ν„°μ λ¨λ“  λ…Έλ“μ— λ™μΌν•κ² μ—΄λ¦½λ‹λ‹¤.
```

**2) Manager Node: μ„λΉ„μ¤ ν¬νΈ μ •λ³΄ ν™•μΈ**
`docker service ls` λ…λ Ήμ–΄λ¥Ό ν†µν•΄ `nginx-port-check` μ„λΉ„μ¤μ `PORTS` μ •λ³΄μ— `*:9999->80/tcp`κ°€ μ •μƒμ μΌλ΅ μ„¤μ •λμ—λ”μ§€ ν™•μΈν•©λ‹λ‹¤.

```bash
docker service ls
```

```tech
docker, swarm
```

```desc
#### π“‹ μ„λΉ„μ¤ ν¬νΈ μ •λ³΄ ν™•μΈ
`docker service ls`λ¥Ό μ‚¬μ©ν•μ—¬ μ„λΉ„μ¤μ— ν¬νΈκ°€ μ¬λ°”λ¥΄κ² μ„¤μ •λμ—λ”μ§€ ν™•μΈν•©λ‹λ‹¤.

- **`PORTS`** μ»¬λΌ: `*:9999->80/tcp` μ™€ κ°™μ΄ ν‘μ‹λλ©΄, λ¨λ“  IP(`*`)μ 9999λ² ν¬νΈκ°€ μ»¨ν…μ΄λ„μ 80λ² ν¬νΈλ΅ μ—°κ²°λμ—μμ„ μλ―Έν•©λ‹λ‹¤.

> π’΅ μ„λΉ„μ¤ μƒμ„± ν›„μ—λ” ν•­μƒ `ls`λ‚ `inspect` λ…λ Ήμ–΄λ΅ μλ„ν• λ€λ΅ μ„¤μ •λμ—λ”μ§€ ν™•μΈν•λ” κ²ƒμ΄ μΆ‹μµλ‹λ‹¤.
```

**3) μ™Έλ¶€μ—μ„ Manager Node IPλ΅ μ ‘μ† ν…μ¤νΈ**
`curl` λ…λ Ήμ–΄λ¥Ό μ‚¬μ©ν•μ—¬ κ΄€λ¦¬μ λ…Έλ“(192.168.0.2)μ 9999λ² ν¬νΈλ΅ μ ‘μ†ν•μ—¬ Nginx ν™μ νμ΄μ§€κ°€ μ •μƒμ μΌλ΅ μ¶λ ¥λλ”μ§€ ν™•μΈν•©λ‹λ‹¤.

```bash
curl http://192.168.0.2:9999
```

```tech
docker, swarm, nginx
```

```desc
#### β… Manager λ…Έλ“λ΅ ν¬νΈ μ ‘μ† ν…μ¤νΈ
`curl`μ„ μ‚¬μ©ν•μ—¬ κ΄€λ¦¬μ λ…Έλ“μ IPμ™€ λ…Έμ¶λ ν¬νΈ(9999)λ΅ μ ‘μ†ν•μ—¬ μ„λΉ„μ¤κ°€ μ‘λ‹µν•λ”μ§€ ν™•μΈν•©λ‹λ‹¤.

- **`curl http://192.168.0.2:9999`**: κ΄€λ¦¬μ λ…Έλ“μ 9999λ² ν¬νΈλ΅ HTTP μ”μ²­

> π’΅ Nginx ν™μ νμ΄μ§€κ°€ λ³΄μ΄λ©΄, ν¬νΈ λ§¤ν•‘κ³Ό μ„λΉ„μ¤κ°€ μ •μƒμ μΌλ΅ λ™μ‘ν•κ³  μλ‹¤λ” μλ―Έμ…λ‹λ‹¤.
```

**4) μ™Έλ¶€μ—μ„ Worker Node IPλ΅ μ ‘μ† ν…μ¤νΈ**
Swarmμ λΌμ°ν… λ©”μ‹(Routing Mesh) κΈ°λ¥ λ•λ¶„μ—, μ„λΉ„μ¤κ°€ μ‹¤μ  μ‹¤ν–‰ν•κ³  μμ§€ μ•μ€ μ‘μ—…μ λ…Έλ“(192.168.0.3)μ 9999λ² ν¬νΈλ΅ μ ‘μ†ν•΄λ„ λ™μΌν• Nginx νμ΄μ§€κ°€ λ³΄μ—¬μ•Ό ν•©λ‹λ‹¤. μ΄λ” Swarmμ΄ μ”μ²­μ„ μ¬λ°”λ¥Έ μ»¨ν…μ΄λ„λ΅ μ „λ‹¬ν•΄μ£ΌκΈ° λ•λ¬Έμ…λ‹λ‹¤.

```bash
curl http://192.168.0.3:9999
```

```tech
docker, swarm, nginx
```

```desc
#### β… Worker λ…Έλ“λ΅ ν¬νΈ μ ‘μ† ν…μ¤νΈ (λΌμ°ν… λ©”μ‹)
ν΄λ¬μ¤ν„° λ‚΄ λ‹¤λ¥Έ λ…Έλ“(μ‘μ—…μ λ…Έλ“)μ λ™μΌν• ν¬νΈλ΅ μ ‘μ†ν•΄λ„ μ„λΉ„μ¤μ— μ ‘κ·Όμ΄ κ°€λ¥ν•μ§€ ν™•μΈν•©λ‹λ‹¤.

- **`curl http://192.168.0.3:9999`**: μ‘μ—…μ λ…Έλ“μ 9999λ² ν¬νΈλ΅ HTTP μ”μ²­

> π’΅ μ΄ μ”μ²­μ΄ μ„±κ³µν•λ” κ²ƒμ€ Swarmμ **λΌμ°ν… λ©”μ‹(Routing Mesh)** λ•λ¶„μ…λ‹λ‹¤. μ–΄λ–¤ λ…Έλ“λ΅ μ”μ²­μ΄ λ“¤μ–΄μ¤λ“ , Swarmμ΄ μ•μ•„μ„ ν•΄λ‹Ή μ„λΉ„μ¤λ¥Ό μ‹¤ν–‰ μ¤‘μΈ μ»¨ν…μ΄λ„λ΅ μ”μ²­μ„ μ „λ‹¬ν•΄μ¤λ‹λ‹¤.
```