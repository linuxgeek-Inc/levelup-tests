##### K8s: CoreDNS ì¥ì•  ì¬í˜„ ë° ë³µêµ¬#####

**1) ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ Deployment YAML ìƒì„±**

```bash
kubectl create deployment web-deploy --image=reallinux/web-server:3 --replicas=1 --dry-run=client -o yaml > web-deploy.yaml
```

```tech
kubectl,deployment,yaml,generate,k8s,bash
```

```desc
#### ğŸ“ Deployment YAML ìƒì„±
`web-deploy`ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ì›¹ ì„œë²„ íŒŒë“œë¥¼ 1ê°œ ì‹¤í–‰í•˜ëŠ” ë””í”Œë¡œì´ë¨¼íŠ¸ë¥¼ ì •ì˜í•©ë‹ˆë‹¤.

- `--image`: ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ (`reallinux/web-server:3`)  
- `--replicas=1`: íŒŒë“œ ìˆ˜ 1ê°œë¡œ ì„¤ì •  
- `--dry-run=client`: ì‹¤ì œ ë°˜ì˜í•˜ì§€ ì•Šê³  YAML ìƒì„±ë§Œ ìˆ˜í–‰  
- `-o yaml > web-deploy.yaml`: YAML íŒŒì¼ë¡œ ì €ì¥  

> ğŸ’¡ ì‹¤ì œ ì ìš© ì „, YAML í…œí”Œë¦¿ì„ ì•ˆì „í•˜ê²Œ ìƒì„±í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤.
```

**2) ìƒì„±ëœ YAML íŒŒì¼ í™•ì¸**

```bash
cat web-deploy.yaml
```

```tech
cat,yaml,k8s,bash
```

```desc
#### ğŸ“– Deployment YAML ë‚´ìš© í™•ì¸
`web-deploy.yaml` íŒŒì¼ì„ ì—´ì–´ ë””í”Œë¡œì´ë¨¼íŠ¸ ì •ì˜ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.

- ì£¼ìš” í•„ë“œ: `metadata.name`, `spec.replicas`, `containers.image`  
- ì—¬ê¸°ì„œ ì„¤ì •ëœ ê°’ì´ ì‹¤ì œ íŒŒë“œ ë°°í¬ ì‹œ ë°˜ì˜ë©ë‹ˆë‹¤.

> ğŸ’¡ ì¿ ë²„ë„¤í‹°ìŠ¤ ë¦¬ì†ŒìŠ¤ë¥¼ YAMLë¡œ ì§ì ‘ ê´€ë¦¬í•˜ëŠ” ìŠµê´€ì„ ë“¤ì´ë©´ ìœ ì§€ë³´ìˆ˜ê°€ í¸ë¦¬í•©ë‹ˆë‹¤.
```

**3) ë””í”Œë¡œì´ë¨¼íŠ¸ ì ìš©**

```bash
kubectl apply -f web-deploy.yaml
```

```tech
kubectl,apply,deployment,k8s,bash
```

```desc
#### ğŸš€ ë””í”Œë¡œì´ë¨¼íŠ¸ ë°°í¬
ì•ì—ì„œ ìƒì„±í•œ `web-deploy.yaml`ì„ ì ìš©í•´ íŒŒë“œë¥¼ ì‹¤ì œë¡œ ì‹¤í–‰í•©ë‹ˆë‹¤.

- ê¸°ëŒ€ ê²°ê³¼: `deployment.apps/web-deploy created`  
- ì´í›„ íŒŒë“œê°€ Running ìƒíƒœë¡œ ê¸°ë™ë©ë‹ˆë‹¤.
```

**4) ì„œë¹„ìŠ¤ YAML ìƒì„±**

```bash
kubectl expose deployment web-deploy --port=80 --target-port=80 --name=web-svc --dry-run=client -o yaml > web-svc.yaml
```

```tech
kubectl,expose,service,yaml,k8s,bash
```

```desc
#### ğŸŒ ì„œë¹„ìŠ¤ YAML ìƒì„±
`web-deploy`ë¥¼ ëŒ€ìƒìœ¼ë¡œ ClusterIP ì„œë¹„ìŠ¤ `web-svc`ë¥¼ ì •ì˜í•©ë‹ˆë‹¤.

- `--port=80`: ì„œë¹„ìŠ¤ í¬íŠ¸  
- `--target-port=80`: ì»¨í…Œì´ë„ˆ í¬íŠ¸  
- `--name=web-svc`: ì„œë¹„ìŠ¤ ì´ë¦„  
- `--dry-run=client -o yaml`: YAMLë§Œ ìƒì„± í›„ ì €ì¥  

> ğŸ’¡ íŒŒë“œ IPëŠ” ë³€ë™ë˜ë¯€ë¡œ ì„œë¹„ìŠ¤ë¡œ ì•ˆì •ì ì¸ ì ‘ê·¼ì ì„ ì œê³µí•©ë‹ˆë‹¤.
```

**5) ìƒì„±ëœ ì„œë¹„ìŠ¤ YAML íŒŒì¼ í™•ì¸**

```bash
cat web-svc.yaml
```

```tech
cat,yaml,k8s,bash
```

```desc
#### ğŸ“– ì„œë¹„ìŠ¤ YAML í™•ì¸
ìƒì„±ëœ `web-svc.yaml` ë‚´ìš©ì„ ì¶œë ¥í•˜ì—¬ í™•ì¸í•©ë‹ˆë‹¤.

- í•„ë“œ: `kind: Service`, `spec.ports`, `spec.selector`  
- íŒŒë“œì™€ ì„œë¹„ìŠ¤ê°€ ì–´ë–»ê²Œ ë§¤í•‘ë˜ëŠ”ì§€ í™•ì¸ ê°€ëŠ¥í•©ë‹ˆë‹¤.
```

**6) ì„œë¹„ìŠ¤ ì ìš©**

```bash
kubectl apply -f web-svc.yaml
```

```tech
kubectl,apply,service,k8s,bash
```

```desc
#### ğŸš€ ì„œë¹„ìŠ¤ ë°°í¬
ì„œë¹„ìŠ¤ë¥¼ í´ëŸ¬ìŠ¤í„°ì— ì ìš©í•´ íŒŒë“œ ì•ë‹¨ì— ì ‘ê·¼ ê°€ëŠ¥í•œ ClusterIPë¥¼ ìƒì„±í•©ë‹ˆë‹¤.

- ê¸°ëŒ€ ê²°ê³¼: `service/web-svc created`  
- DNS ì´ë¦„: `web-svc.default.svc.cluster.local`  
```

**7) í˜„ì¬ ë¦¬ì†ŒìŠ¤ ìƒíƒœ í™•ì¸**

```bash
sleep 5 && kubectl get all
```

```tech
kubectl,get,all,k8s,bash
```

```desc
#### ğŸ“Š ì „ì²´ ë¦¬ì†ŒìŠ¤ í™•ì¸
ì ì‹œ ëŒ€ê¸° í›„ í˜„ì¬ íŒŒë“œ, ì„œë¹„ìŠ¤, ë””í”Œë¡œì´ë¨¼íŠ¸ì˜ ìƒíƒœë¥¼ ì¶œë ¥í•©ë‹ˆë‹¤.

- Running ìƒíƒœì˜ íŒŒë“œ(web-deploy)  
- ClusterIP íƒ€ì…ì˜ ì„œë¹„ìŠ¤(web-svc)  

> ğŸ’¡ ì •ìƒ í™˜ê²½ì—ì„œ DNS ì¡°íšŒ ë° ì„œë¹„ìŠ¤ ì ‘ê·¼ì´ ê°€ëŠ¥í•´ì•¼ í•©ë‹ˆë‹¤.
```

**8) CoreDNS ìƒíƒœ í™•ì¸**

```bash
kubectl -n kube-system get deploy coredns
```

```tech
kubectl,get,coredns,k8s,bash
```

```desc
#### ğŸ§© CoreDNS ë””í”Œë¡œì´ë¨¼íŠ¸ ìƒíƒœ í™•ì¸
ì¿ ë²„ë„¤í‹°ìŠ¤ ë„¤íŠ¸ì›Œí¬ì˜ DNS ì„œë²„ ì—­í• ì„ í•˜ëŠ” CoreDNSì˜ ìƒíƒœë¥¼ í™•ì¸í•©ë‹ˆë‹¤.

- ì •ìƒ: `AVAILABLE` íŒŒë“œ ìˆ˜ > 0  
- CoreDNSëŠ” ëª¨ë“  ì„œë¹„ìŠ¤ DNS í•´ì„ì„ ë‹´ë‹¹í•©ë‹ˆë‹¤.
```

**9) DNS í…ŒìŠ¤íŠ¸ìš© pod ìƒì„±**

```bash
kubectl run dns-test --image=curlimages/curl:8.8.0 --restart=Never -- sleep 3600
```

```tech
kubectl,run,pod,dns-test,k8s,bash
```

```desc
#### ğŸ§ª í…ŒìŠ¤íŠ¸ pod ì‹¤í–‰
DNS í™•ì¸ì„ ìœ„í•´ `curl` ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©í•œ ë‹¨ë°œì„± íŒŒë“œë¥¼ ìƒì„±í•©ë‹ˆë‹¤.

- `--restart=Never`: ì¡ í˜•íƒœ íŒŒë“œë¡œ ì‹¤í–‰  
- `sleep 3600`: íŒŒë“œê°€ 1ì‹œê°„ ë™ì•ˆ ëŒ€ê¸°  

> ğŸ’¡ ë…ë¦½ì ì¸ í…ŒìŠ¤íŠ¸ í™˜ê²½ì„ ì œê³µí•˜ì—¬ CoreDNSì™€ ì„œë¹„ìŠ¤ ì ‘ê·¼ì„ í™•ì¸í•©ë‹ˆë‹¤.
```

**10) í…ŒìŠ¤íŠ¸ pod ì¤€ë¹„ ëŒ€ê¸°**

```bash
kubectl wait --for=condition=Ready pod/dns-test --timeout=60s
```

```tech
kubectl,wait,pod,k8s,bash
```

```desc
#### â³ íŒŒë“œ ì¤€ë¹„ ëŒ€ê¸°
`dns-test` íŒŒë“œê°€ Running/Ready ìƒíƒœê°€ ë  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦½ë‹ˆë‹¤.

- `--for=condition=Ready`: íŒŒë“œ ì¤€ë¹„ ìƒíƒœ í™•ì¸  
- `--timeout=60s`: 60ì´ˆ ë‚´ ëŒ€ê¸°  
```

**11) ì •ìƒ DNS ì¡°íšŒ ë° ì„œë¹„ìŠ¤ ì ‘ê·¼ í™•ì¸**

```bash
kubectl exec -it dns-test -- curl http://web-svc.default.svc.cluster.local
```

```tech
kubectl,exec,curl,dns,k8s,bash
```

```desc
#### âœ… ì •ìƒ ìƒíƒœì—ì„œ ì„œë¹„ìŠ¤ ì ‘ê·¼
`dns-test` íŒŒë“œ ë‚´ë¶€ì—ì„œ `curl`ì„ í†µí•´ ì„œë¹„ìŠ¤ DNSë¡œ ì ‘ê·¼í•©ë‹ˆë‹¤.

- ê¸°ëŒ€ ê²°ê³¼: ì›¹ ì„œë²„ ì‘ë‹µ(HTML ì†ŒìŠ¤ ë“±) ì •ìƒ ì¶œë ¥  
- CoreDNSê°€ ì •ìƒ ë™ì‘í•˜ë©´ ì„œë¹„ìŠ¤ ì´ë¦„ìœ¼ë¡œ í†µì‹  ê°€ëŠ¥í•©ë‹ˆë‹¤.
```

**12) CoreDNS ì¤‘ì§€ (ì¥ì•  ì¬í˜„)**

```bash
kubectl -n kube-system scale deploy coredns --replicas=0
```

```tech
kubectl,scale,coredns,disable,k8s,bash
```

```desc
#### ğŸ’¥ CoreDNS ë¬¸ì œìƒí™© ìœ ë°œ
CoreDNS íŒŒë“œ ê°œìˆ˜ë¥¼ 0ìœ¼ë¡œ ì¤„ì—¬ DNS ì„œë²„ë¥¼ ì¤‘ì§€ì‹œí‚µë‹ˆë‹¤.

- DNS í•´ì„ ë¶ˆê°€ ìƒíƒœ ë°œìƒ  
- ì„œë¹„ìŠ¤ ì´ë¦„ì„ í†µí•œ ì ‘ê·¼ì´ ëª¨ë‘ ì‹¤íŒ¨í•´ì•¼ ì •ìƒì ì¸ ì¥ì•  ì¬í˜„ì…ë‹ˆë‹¤.
```

**13) CoreDNS ìƒíƒœ í™•ì¸ (ì¤‘ì§€ í›„)**

```bash
kubectl -n kube-system get deploy coredns
```

```tech
kubectl,get,coredns,k8s,bash
```

```desc
#### ğŸ“‰ CoreDNS ë¹„í™œì„± ìƒíƒœ í™•ì¸
CoreDNSì˜ íŒŒë“œ ìˆ˜ê°€ 0ìœ¼ë¡œ í‘œì‹œë˜ë©° ì¤‘ì§€ë˜ì—ˆìŒì„ í™•ì¸í•©ë‹ˆë‹¤.
```

**14) CoreDNS ì¥ì•  ìƒí™©ì—ì„œ ì„œë¹„ìŠ¤ ì ‘ê·¼ ì‹œë„**

```bash
kubectl exec -it dns-test -- curl http://web-svc.default.svc.cluster.local
```

```tech
kubectl,exec,curl,dns-fail,k8s,bash
```

```desc
#### âŒ DNS ì¥ì•  í™•ì¸
CoreDNSê°€ êº¼ì§„ ìƒíƒœì—ì„œ DNS ê¸°ë°˜ ì„œë¹„ìŠ¤ ì´ë¦„ ì ‘ê·¼ì„ ì‹œë„í•©ë‹ˆë‹¤.

- ê¸°ëŒ€ ê²°ê³¼: DNS í•´ì„ ì‹¤íŒ¨ (`Could not resolve host`)  
- ì§ì ‘ Pod IPë¡œëŠ” ì ‘ê·¼ ê°€ëŠ¥í•˜ì§€ë§Œ DNS ê¸°ë°˜ ì´ë¦„ì€ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.
```

**15) CoreDNS ë³µêµ¬**

```bash
kubectl -n kube-system scale deploy coredns --replicas=1
```

```tech
kubectl,scale,coredns,enable,k8s,bash
```

```desc
#### ğŸ”„ CoreDNS ë³µêµ¬
CoreDNS íŒŒë“œ ê°œìˆ˜ë¥¼ ë‹¤ì‹œ 1ê°œë¡œ ëŠ˜ë ¤ DNS ì„œë²„ë¥¼ ë³µì›í•©ë‹ˆë‹¤.
```

**16) CoreDNS ë³µêµ¬ ìƒíƒœ í™•ì¸**

```bash
sleep 3 && kubectl -n kube-system get deploy coredns
```

```tech
kubectl,get,coredns,recovery,k8s,bash
```

```desc
#### ğŸ“ˆ CoreDNS ì •ìƒí™” í™•ì¸
ì ì‹œ ëŒ€ê¸° í›„ CoreDNS íŒŒë“œê°€ Running ìƒíƒœë¡œ ë³µêµ¬ë˜ì—ˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
```

**17) DNS ê¸°ë°˜ ì„œë¹„ìŠ¤ ì ‘ê·¼ ì¬í™•ì¸**

```bash
kubectl exec -it dns-test -- curl http://web-svc.default.svc.cluster.local
```

```tech
kubectl,exec,curl,dns-success,k8s,bash
```

```desc
#### âœ… ë³µêµ¬ í›„ ì •ìƒ ë™ì‘ í™•ì¸
CoreDNSê°€ ë³µêµ¬ë˜ë©´ ë‹¤ì‹œ ì„œë¹„ìŠ¤ ì´ë¦„ìœ¼ë¡œ ì ‘ê·¼ì´ ì •ìƒ ë™ì‘í•©ë‹ˆë‹¤.

- ê¸°ëŒ€ ê²°ê³¼: ì›¹ ì„œë²„ ì‘ë‹µì´ ì •ìƒì ìœ¼ë¡œ ì¶œë ¥  
- ì¥ì•  â†’ ì‹¤íŒ¨ â†’ ë³µêµ¬ â†’ ì •ìƒ ë™ì‘ íë¦„ì„ ì²´í—˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```

**18) ì‹¤ìŠµ ì¢…ë£Œ**

```bash
: quit
```

```tech
bash,rocky
```

```desc
#### ğŸ‘‹ ì‹¤ìŠµ ì¢…ë£Œ
ì‹¤ìŠµì„ ì¢…ë£Œë¥¼ ì˜ë¯¸í•˜ëŠ” `quit` ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.  
í˜„ì¬ í„°ë¯¸ë„ ì„¸ì…˜ì„ ì¢…ë£Œí•©ë‹ˆë‹¤.

```
