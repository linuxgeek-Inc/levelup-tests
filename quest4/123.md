##### 쿠버네티스 네트워크 기본구조 확인#####

**1) 노드 상태와 네트워크 정보 확인**

```bash
kubectl get nodes -o wide
```

```tech
kubectl,get,nodes,wide,k8s,bash
```

```desc
#### 🖥️ 클러스터 노드 정보 확인
클러스터에 등록된 모든 노드와 각 노드의 세부 상태를 출력합니다.

- `-o wide`: 기본 정보 외에 **내부 IP, OS, 커널 버전, 컨테이너 런타임**까지 상세 확인
- 출력 항목: NAME, STATUS, ROLES, INTERNAL-IP, OS-IMAGE, KERNEL-VERSION 등
- 네트워크 분석 포인트: 각 노드의 **내부 IP**는 파드 간 통신의 기본 경로로 활용됩니다.

> 💡 전체 네트워크 토폴로지 파악의 출발점이 되는 명령어입니다.
```

**2) 마스터 노드에 직접 접속**

```bash
ssh k8s-master
```

```tech
ssh,k8s,master,bash
```

```desc
#### 🔑 마스터 노드 접속
제어 노드(Master)에 직접 접속하여 **브리지 네트워크(cni0)** 와 **veth 인터페이스** 상태를 확인할 수 있습니다.

- 목적: 파드 네트워크가 실제 리눅스 네트워크 장치에 어떻게 매핑되는지 관찰
- 보통 워커 노드에도 접속하여 비교 관찰하면 더 효과적입니다.

> 💡 쿠버네티스 네트워크는 결국 리눅스 네트워크 네임스페이스/브리지 기반으로 동작한다는 점을 확인하는 과정입니다.
```

**3) 전체 파드 네트워크 정보 확인**

```bash
kubectl get pods --all-namespaces -o wide
```

```tech
kubectl,get,pods,wide,k8s,bash
```

```desc
#### 📦 모든 파드 네트워크 확인
클러스터의 모든 네임스페이스에서 실행 중인 파드와 네트워크 정보를 출력합니다.

- `-A, --all-namespaces`: 모든 네임스페이스 표시
- `-o wide`: 파드의 **Pod IP, 실행 중인 노드명**까지 함께 확인
- 활용: 특정 파드가 어떤 노드에 배치되어 어떤 IP를 받았는지 추적 가능

> 💡 Pod-to-Pod 통신 경로 분석의 기초 자료로 활용됩니다.
```

**4) 웹 애플리케이션 디플로이먼트 YAML 생성 (드라이런)**

```bash
kubectl create deployment web-deploy --image=reallinux/web-server:3 --replicas=3 --dry-run=client -o yaml > web-deploy.yaml
```

```tech
kubectl,deployment,yaml,generate,k8s,bash
```

```desc
#### 📝 매니페스트 파일 생성
`web-deploy`라는 이름의 디플로이먼트를 정의하는 YAML을 생성합니다.

- `--image`: 컨테이너 이미지 지정 (`reallinux/web-server:3`)
- `--replicas=3`: 동일한 파드를 3개 생성하도록 정의
- `--dry-run=client`: 실제 적용은 하지 않고 결과만 출력
- `-o yaml > web-deploy.yaml`: 결과를 YAML 형식으로 저장

> 💡 직접 YAML을 작성하지 않고 **자동 생성 후 수정/적용**하는 실습 흐름을 경험할 수 있습니다.
```

**5) 생성된 YAML 파일 확인**

```bash
cat web-deploy.yaml
```

```tech
cat,yaml,k8s,bash
```

```desc
#### 📖 매니페스트 내용 확인
생성된 `web-deploy.yaml` 파일의 내용을 확인합니다.

- 주요 필드: `apiVersion`, `kind`, `metadata`, `spec`
- `replicas: 3`, `containers.image: reallinux/web-server:3` 확인
- 사람이 직접 YAML을 다루는 것보다 **자동 생성 결과를 이해하는 학습**에 초점

> 💡 매니페스트 구조를 직접 눈으로 확인하고 수정할 수 있는 기초 단계입니다.
```

**6) 디플로이먼트 적용**

```bash
kubectl apply -f web-deploy.yaml
```

```tech
kubectl,apply,deployment,k8s,bash
```

```desc
#### 🚀 리소스 적용
매니페스트를 실제 클러스터에 반영하여 파드를 생성합니다.

- `apply`: 변경 사항을 반영하거나 신규 생성
- 기대 결과: `deployment.apps/web-deploy created`

> 💡 선언형 방식으로 리소스를 관리하는 쿠버네티스의 핵심 개념을 실습합니다.
```

**7) 파드 실행 상태 확인 (잠시 대기 후)**

```bash
kubectl wait --for=condition=Available deployment/web-deploy --timeout=60s
```

```tech
kubectl,wait,deployment,k8s,bash
```

```desc
#### ⏱️ 디플로이먼트 준비 상태 대기
`web-deploy` 디플로이먼트가 **Available** 상태가 될 때까지 기다립니다.

- `--for=condition=Available`: 디플로이먼트가 정상 동작 가능한 상태가 될 때까지 대기
- `--timeout=60s`: 최대 60초 동안만 대기, 그 안에 조건 만족하지 않으면 종료
- Pod 개수가 많을 때는 안정적으로 Running 상태를 보장할 수 있음

> 💡 단순히 `sleep` 으로 기다리는 것보다 **실제 상태 기반**으로 대기하는 것이 더 정확합니다.
```

**8) 파드 실행 상태 점검**

```bash
kubectl get all -o wide
```

```tech
kubectl,get,all,wide,k8s,bash
```

```desc
#### ⏱️ 리소스 상태 점검
잠시 대기 후, 모든 네임스페이스의 디플로이먼트, 레플리카셋, 파드 상태를 확인합니다.

- `kubectl get all`: 서비스, 파드, 디플로이먼트 등 종합 출력
- `-o wide`: 파드 IP와 노드 배치까지 상세 확인 가능
- 기대 결과: web-deploy 파드 3개가 Running 상태

> 💡 파드가 여러 노드에 분산되는지, 어떤 IP를 받는지 관찰하는 것이 네트워크 구조 확인의 핵심입니다.
```

**9) 파드 IP 추출하기**

```bash
POD_IP=$(kubectl get pods -o jsonpath='{.items[0].status.podIP}')
```

```tech
kubectl,get,podIP,jsonpath,k8s,bash
```

```desc
#### 🔎 파드 IP 추출
실행 중인 파드 중 첫 번째 파드의 IP 주소를 변수 `POD_IP`에 저장합니다.

- `-o jsonpath='{.items[0].status.podIP}'`: JSON 출력에서 첫 번째 파드의 IP만 추출
- 여러 파드가 있을 경우 그 중 **첫 번째 파드 IP** 만 가져옴
- 추출된 값은 이후 `curl` 테스트에 사용

> 💡 네트워크 연결 테스트를 자동화할 때 유용합니다.
```

**10) 파드 IP에 직접 접근 테스트**

```bash
curl $POD_IP
```

```tech
curl,k8s,network,bash
```

```desc
#### 🌐 네트워크 연결 확인
파드 IP 또는 서비스 ClusterIP에 `curl` 요청을 보내 연결을 테스트합니다.

- 정상 동작 시 웹 서버의 응답(예: HTML 페이지 소스) 출력
- 실패 시 네트워크 정책, CNI 설정, 서비스 구성을 의심해야 함

> 💡 Pod-to-Service 네트워크 흐름을 직접 체험하는 단계입니다.
```

**11) cni0 브리지 네트워크 확인**

```bash
ip addr show | grep -A20 cni0
```
```no-err-check
```

```tech
ip,cni0,bridge,k8s,bash
```

```desc
#### 🔎 CNI 브리지 인터페이스 확인
파드 네트워크를 연결하는 리눅스 브리지 **cni0**의 인터페이스 정보를 확인합니다.

- 출력 항목: 브리지 MAC, IP, 서브넷 범위
- 보통 Pod IP CIDR 대역과 일치
- 브리지에 여러 veth 인터페이스가 붙어 있음

> 💡 파드 네트워크의 핵심 허브 역할을 하는 구조를 눈으로 확인합니다.
```

**12) veth 인터페이스 확인**

```bash
ip addr show | grep veth
```
```no-err-check
```

```tech
ip,veth,network,k8s,bash
```

```desc
#### 🔗 파드와 브리지 연결
각 파드는 호스트와 veth 페어를 통해 연결됩니다.

- 한쪽 끝: 파드 네임스페이스 내부 인터페이스
- 다른쪽 끝: 호스트 cni0 브리지에 연결
- 여러 개의 veth가 브리지에 붙어 있으면 다수의 파드가 실행 중임을 의미

> 💡 Pod-to-Bridge 연결 방식을 실무적으로 이해하는 핵심 포인트입니다.
```

**13) 브리지 관리 도구 설치**

```bash
sudo apt install bridge-utils
```

```tech
apt,install,bridge-utils,k8s,bash
```

```desc
#### 🛠️ 브리지 도구 설치
리눅스 브리지를 확인하는 도구 `brctl`을 사용하기 위해 설치합니다.

- 기본적으로 Ubuntu/Debian 계열에서 사용
- CentOS/Rocky 계열은 `yum install bridge-utils` 사용
- `brctl show` 명령으로 브리지-인터페이스 관계를 확인 가능

> 💡 네트워크 관리자들이 브리지 토폴로지 파악에 즐겨 쓰는 도구입니다.
```

**14) 브리지 네트워크 구조 출력**

```bash
brctl show
```

```tech
brctl,bridge,network,k8s,bash
```

```desc
#### 🌉 브리지 네트워크 구조 확인
호스트 내 브리지와 각 인터페이스의 연결 관계를 보여줍니다.

- 첫 컬럼: 브리지 이름 (예: cni0)
- 마지막 컬럼: 연결된 인터페이스 목록 (예: vethXXXX)
- Pod-to-Pod 통신이 어떻게 브리지를 통해 이어지는지 확인 가능

> 💡 쿠버네티스 네트워크 구조의 실제 연결 관계를 시각적으로 확인할 수 있습니다.
```

**15) 마스터 노드에서 실행 중인 파드 확인**

```bash
kubectl get pods --all-namespaces -o wide | grep k8s-master | grep Running | nl
```

```tech
kubectl,get,pods,master,k8s,bash
```

```desc
#### 🧾 마스터 노드 파드 목록
마스터 노드에 할당된 파드만 필터링해 번호와 함께 확인합니다.

- `grep k8s-master`: 마스터 노드에서 실행 중인 파드만 표시
- `grep Running`: 실행 중인 파드만 표시
- `nl`: 라인 번호 출력

> 💡 특정 노드에서 파드가 어떻게 배치되는지 추적할 수 있습니다.
```

**16) 브리지 정보 번호와 함께 출력**

```bash
brctl show | nl -v 0
```

```tech
brctl,bridge,show,k8s,bash
```

```desc
#### 📊 브리지 매핑 구조
브리지 출력 결과를 번호와 함께 확인합니다.

- `nl -v 0`: 줄 번호를 0부터 매겨 출력
- 여러 브리지(cni0, docker0 등)가 공존하는 환경에서는 번호를 매겨 관리하기 편리

> 💡 여러 브리지 정보를 정리할 때 유용합니다.
```

**17) 실습 종료**

```bash
: quit
```

```tech
bash,rocky
```

```desc
#### 👋 실습 종료
실습을 종료를 의미하는 `quit` 명령어를 실행합니다.  
현재 터미널 세션을 종료합니다.

> 💡 모든 실습을 마친 후 사용합니다.
```