##### google.com DNS 네트워크 추적하기 #####

**1) Wireshark CLI 도구 설치**

```bash
sudo dnf install -y wireshark-cli
```

```tech
sudo,dnf,install,wireshark-cli,bash,rocky
```

```desc
#### 📦 tshark(Wireshark CLI) 설치
`sudo dnf install -y wireshark-cli`는 네트워크 패킷 분석 도구인 Wireshark의 CLI 버전, `tshark`를 설치합니다.

- **sudo**: 관리자 권한으로 실행합니다.
- **dnf install -y**: Rocky Linux에서 패키지를 설치하며, 모든 확인 프롬프트에 자동으로 'yes'로 답합니다.

> 💡 GUI 없이 터미널 환경에서 네트워크 패킷을 캡처하고 분석할 때 필수적인 도구입니다. `tshark`가 이미 설치되어 있다면 이 단계는 생략될 수 있습니다.
```

**2) tshark 명령어 설명 확인**

```bash
whatis tshark
```

```tech
whatis,tshark,bash,rocky
```

```desc
#### 📖 tshark 명령어 설명 확인
`whatis tshark`는 `tshark` 명령어가 무엇인지 간단한 설명을 보여줍니다. 네트워크 트래픽을 캡처하고 분석하는 강력한 도구입니다.

- **출력 내용**: `tshark` 명령어에 대한 짧은 설명
- **Wireshark CLI**: GUI 버전의 Wireshark와 동일한 기능을 터미널에서 제공합니다.

> 💡 서버 환경에서 실시간으로 네트워크 문제를 진단할 때 매우 유용합니다.
```

**3) DNS 패킷 추적 로그 파일로 저장**

```bash
sudo tshark -i eth0 -Y dns -a duration:10 2> /dev/null > dns.log &
```

```tech
sudo,tshark,bash,rocky
```

```desc
#### 🔍 DNS 패킷 추적 및 파일 저장
`sudo tshark ...` 명령어는 10초 동안 `eth0` 인터페이스에서 DNS 관련 패킷만 캡처하여 `dns.log` 파일에 저장합니다.

- **-i eth0**: `eth0` 네트워크 인터페이스를 지정합니다.
- **-Y dns**: DNS 프로토콜만 필터링하여 보여줍니다.
- **-a duration:10**: 10초 동안만 캡처를 실행합니다.
- **2> /dev/null**: 표준 오류(stderr)는 버립니다.
- **> dns.log**: 표준 출력(stdout)을 `dns.log` 파일로 리디렉션합니다.
- **&**: 명령어를 백그라운드에서 실행시켜 다른 작업을 계속할 수 있습니다.

> 💡 네트워크 트래픽을 파일로 저장하면 나중에 분석하거나 다른 사람과 공유하기 편리합니다. 오류 메시지를 제외하고 결과만 저장하는 것도 좋은 습관입니다.
```

**4) www.google.com에 HTTP 헤더 요청**

```bash
curl -I www.google.com
```

```tech
curl,bash,rocky
```

```desc
#### 🌐 HTTP 요청으로 DNS 쿼리 유발
`curl -I www.google.com` 명령어는 `www.google.com`의 HTTP 헤더 정보만 요청합니다. 이 과정에서 시스템은 `www.google.com`의 IP 주소를 알기 위해 DNS 서버에 쿼리를 보내게 됩니다.

- **-I**: HTTP 헤더 정보만 가져옵니다 (HEAD 요청).
- **DNS 쿼리 유발**: 이 명령어를 실행하는 순간, `tshark`가 캡처하고 있는 네트워크에 DNS 쿼리 패킷이 발생합니다.

> 💡 특정 도메인에 대한 네트워크 트래픽을 인위적으로 발생시켜 패킷 캡처를 테스트할 때 유용한 방법입니다.
```

**5) 추적된 DNS 로그 확인**

```bash
sleep 8 && cat dns.log
```

```tech
sleep,cat,bash,rocky
```

```desc
#### 📄 로그 파일 내용 확인
`tshark`가 10초 동안 캡처를 완료할 시간을 벌기 위해 8초간 기다린(`sleep 8`) 후, `dns.log` 파일의 내용을 출력(`cat dns.log`)합니다.

- **sleep 8**: 8초 동안 대기합니다. `tshark`가 캡처를 마치고 파일에 내용을 쓸 시간을 확보합니다.
- **&&**: 앞의 명령(`sleep 8`)이 성공적으로 끝나면 뒤의 명령(`cat dns.log`)을 실행합니다.
- **cat dns.log**: `dns.log` 파일의 내용을 터미널에 출력합니다.

> 💡 `curl` 명령으로 인해 발생한 `google.com`에 대한 표준 DNS 쿼리(A, AAAA 레코드)와 그 응답을 확인할 수 있습니다.
```

**6) 실습 종료**

```bash
: quit
```

```tech
bash,rocky
```

```desc
#### 👋 실습 종료
실습을 종료를 의미하는 `quit` 명령어를 실행합니다.
현재 터미널 세션을 종료합니다.

> 💡 모든 실습을 마친 후 사용합니다.
```
